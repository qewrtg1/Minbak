<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <title>User Information Update</title>
  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .main-content {
        max-width: 1200px;
        background-color: rgba(0, 0, 0, 0.05);
        padding: 20px;
        margin: 30px auto;
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }

    .form-container, .info-container {
        flex: 1;
        min-width: 48%;
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
    }

    #payment-table{
      border-collapse: collapse;
    }
    #payment-table tr{
      text-align: center;
      border: none;
    }
    #payment-table th{
      font-size:13px;
      padding:0px;
      text-align: center;
      border: none;
    }
    #payment-table td{
      border: none;

    }

    @media (max-width: 768px) {
      .form-container, .info-container {
          min-width: 100%;
      }
    }
  </style>
</head>
<body>

<!--<script th:if="${message}">-->
<!--  alert("[[${message}]]");-->
<!--</script>-->

<main class="main-content d-flex flex-wrap">
  <h2 class="w-100 text-center mb-4">ìœ ì € ì •ë³´ ìˆ˜ì • í˜ì´ì§€</h2>

  <!-- ìœ ì € ìˆ˜ì • í¼ -->
  <div class="form-container p-4">
    <form action="/admin/users/update" method="POST">
      <input id="userId" type="hidden" name="userId" th:value="${userDto.userId}">

      <div class="mb-3">
        <label for="name" class="form-label">ì´ë¦„</label>
        <input type="text" id="name" name="name" th:value="${userDto.name}" class="form-control" required>
      </div>

      <div class="mb-3">
        <label for="email" class="form-label">ì´ë©”ì¼</label>
        <input type="email" id="email" name="email" th:value="${userDto.email}" class="form-control" required>
      </div>

      <div class="mb-3">
        <label for="phoneNumber" class="form-label">ì „í™”ë²ˆí˜¸</label>
        <input type="text" id="phoneNumber" name="phoneNumber" th:value="${userDto.phoneNumber}" pattern="^\d{3}-\d{3,4}-\d{4}$" class="form-control" required>
      </div>

      <div class="mb-3">
        <label for="enabled" class="form-label">ê³„ì • ìƒíƒœ</label>
        <select id="enabled" name="enabled" class="form-select">
          <option value="true" th:selected="${userDto.enabled}">Active</option>
          <option value="false" th:selected="${!userDto.enabled}">Inactive</option>
        </select>
      </div>

      <p class="text-muted">íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½ ìš”ì²­ ì‹œ ì´ë©”ì¼ ë°œì†¡</p>

      <button type="submit" class="btn btn-primary w-30">ìˆ˜ì •</button>
    </form>
  </div>

  <!-- ìœ ì € ì¶”ê°€ ì •ë³´ -->
  <div class="info-container p-4">

    <div class="info-box border-bottom pb-3 mb-3">
      <h4>ğŸ“… ìµœê·¼ ì ‘ì†ì¼</h4>
      <p class="fw-bold">2025-02-13 (ë¦¬í”„ë ˆì‹œ í† í°ìœ¼ë¡œ êµ¬í˜„?)</p>
    </div>

    <div class="info-box border-bottom pb-3 mb-3">
      <h4>ğŸ  ë³´ìœ  ìˆ™ì†Œ</h4>
      <ul id="property-list" class="list-group"></ul>
<!--      <nav aria-label="Page navigation" class="page-nav" id="pagination-1">-->
<!--        <ul class="pagination justify-content-center">-->
<!--          <li class="page-item" th:classappend="${userPageDto.hasPrev} ? '' : 'disabled'"><a class="page-link" th:href="@{/admin/users?page={page}(page=${userPageDto.currentPage - 1})}">Â«</a></li>-->
<!--          <li class="page-item" th:each="i : ${#numbers.sequence(userPageDto.startPage, userPageDto.endPage)}">-->
<!--            <a class="page-link" th:classappend="${userPageDto.currentPage == i} ? 'active text-white' : ''"th:href="@{/admin/users?page={i}(i=${i})}" th:text="${i}">1</a>-->
<!--          </li>-->
<!--          <li class="page-item" th:classappend="${userPageDto.hasNext} ? '' : 'disabled'"><a class="page-link" th:href="@{/admin/users?page={page}(page=${userPageDto.currentPage + 1})}">Â»</a></li>-->
<!--        </ul>-->
<!--      </nav>-->
    </div>

    <div class="info-box">
      <h4>ğŸ’³ ê²°ì œ ë‚´ì—­</h4>
      <table id="payment-table" class="table table-bordered">
        <thead class="table-white">
        <tr>
          <th>ìˆ™ì†Œ ì´ë¦„</th>
          <th>ê°€ê²©</th>
          <th>ê²°ì œì¼</th>
        </tr>

        </thead>
        <tbody>
        <!-- ê²°ì œ ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ê²ƒì…ë‹ˆë‹¤. -->
        </tbody>
      </table>

      <nav aria-label="Page navigation" class="page-nav" id="pagination-2">

      </nav>
    </div>
  </div>
</main>
<!--axios-->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>

  let currentPage1 = 1;
  let currentPage2 = 1;
  const pageSize = 5;  // í˜ì´ì§€ë‹¹ í‘œì‹œí•  ë°ì´í„° ìˆ˜
  const userId = document.getElementById("userId").value;

  window.onload = function() {
   filterUsersPayments(); // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²°ì œ ë‚´ì—­ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
  };

  function filterUsersPayments() {

      // axiosë¥¼ ì‚¬ìš©í•´ì„œ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
      axios.get('/api/users/payments', {
          params: {
              userId: userId,   // ìœ ì €id
              page: currentPage2,     // í˜„ì¬ í˜ì´ì§€
              size: pageSize         // í˜ì´ì§€ í¬ê¸°
          }
      })
      .then(response => {
          const data = response.data;

          renderTable2(data.objects);  // í…Œì´ë¸”ì„ ê°±ì‹ í•©ë‹ˆë‹¤.
          renderPagination2(data);      // í˜ì´ì§€ë„¤ì´ì…˜ì„ ê°±ì‹ í•©ë‹ˆë‹¤.
      })
      .catch(error => {
          console.error("Error fetching data", error);
      });
  }

  // í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
  function renderTable2(payments) {
      const tbody = document.querySelector("#payment-table tbody");
      tbody.innerHTML = "";  // ê¸°ì¡´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”

      payments.forEach(payment => {
        const date = new Date(payment.createdAt);
        const formattedDate = date.toLocaleDateString('ko-KR');

          const row = document.createElement("tr");
          row.innerHTML = `
                <td><a href="/admin/payments/${payment.paymentId}">${payment.roomName}</a></td>
                <td>${payment.amount}</td>
                <td>${formattedDate}</td>
          `;
          tbody.appendChild(row);
      });
  }


  function renderPagination2(data) {
  let paginationDiv = document.getElementById("pagination-2");
  paginationDiv.innerHTML = "";  // ê¸°ì¡´ í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”

  const currentPage = data.currentPage;  // í˜„ì¬ í˜ì´ì§€
  const totalItems = data.totalItems;    // ì „ì²´ ìœ ì € ìˆ˜
  const totalPages = data.totalPages;    // ì „ì²´ í˜ì´ì§€ ìˆ˜
  const startPage = data.startPage;      // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ì‹œì‘ í˜ì´ì§€
  const endPage = data.endPage;          // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ë í˜ì´ì§€
  const hasPrev = data.hasPrev;          // ì´ì „ í˜ì´ì§€ ì—¬ë¶€
  const hasNext = data.hasNext;          // ë‹¤ìŒ í˜ì´ì§€ ì—¬ë¶€

  // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ì„ ìœ„í•œ HTML ì‹œì‘
  let paginationHTML = `
      <ul class="pagination justify-content-center pagination-sm">
          <!-- ì´ì „ ë²„íŠ¼ -->
          <li class="page-item ${hasPrev ? '' : 'disabled'}">
              <a class="page-link" href="#" aria-label="Previous" onclick="changePage(${currentPage - 1})">Â«</a>
          </li>
  `;

  // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ë“¤
  for (let i = startPage; i <= endPage; i++) {
      paginationHTML += `
          <li class="page-item ${currentPage === i ? 'active' : ''}">
              <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
          </li>
      `;
  }

  // ë‹¤ìŒ ë²„íŠ¼
  paginationHTML += `
          <li class="page-item ${hasNext ? '' : 'disabled'}">
              <a class="page-link" href="#" aria-label="Next" onclick="changePage(${currentPage + 1})">Â»</a>
          </li>
      </ul>
  `;

  // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ì„ DOMì— ì‚½ì…
      paginationDiv.innerHTML = paginationHTML;
  }

      function changePage(page) {

        // í˜ì´ì§€ ë³€ê²½ ë¡œì§ (ê²€ìƒ‰ì–´ì™€ í˜ì´ì§€ í¬ê¸°, í˜ì´ì§€ ë²ˆí˜¸ ë“±)
        axios.get('/api/users/payments', {
            params: {
                userId: userId,        // ê²€ìƒ‰ì–´
                page: page,            // ìƒˆ í˜ì´ì§€ ë²ˆí˜¸
                size: pageSize         // í˜ì´ì§€ í¬ê¸°
            }
        })
        .then(response => {
            const data = response.data;
            renderTable2(data.objects);  // ìœ ì € ëª©ë¡ ë Œë”ë§
            renderPagination2(data);     // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ë Œë”ë§
        })
        .catch(error => {
            console.error("í˜ì´ì§€ë¥¼ ë¡œë“œí•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
        });
    }
</script>
</body>
</html>
