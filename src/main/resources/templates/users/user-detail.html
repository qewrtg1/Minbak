<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base/layout-sample}">

<head>
    <meta charset="UTF-8">
    <title>User Information Update</title>

    <th:block layout:fragment="css">
        <style>
            .form-container, .info-container {
                flex: 1;
                min-width: 48%;
                background: white;
                border-radius: 8px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                padding: 20px;
            }

            #payment-table, #room-table{
              border-collapse: collapse;
            }
            #payment-table tr, #room-table tr{
              text-align: center;
              border: none;
            }
            #payment-table th, #room-table th{
              font-size:13px;
              padding:0px;
              text-align: center;
              border: none;
            }
            #payment-table td, #room-table td{
              border: none;
              font-size:14px;
            }
            .message-container {
                border-top: 1px solid #ddd;
                padding-top: 20px;
            }

            .form-label {
                font-size: 14px;
            }

            #message-status {
                font-size: 14px;
                color: green;
                font-weight: bold;
            }
        </style>
    </th:block>
</head>
<body style="overflow-y:hidden;">

<script th:if="${message}">
  alert("[[${message}]]");
</script>
<th:block layout:fragment="content">

    <main class="main-content d-flex flex-wrap">
        <h3 class="w-100 text-center" style="font-size:25px;">ìœ ì € ì •ë³´ ìƒì„¸ í˜ì´ì§€</h3>

        <!-- ìœ ì € ìˆ˜ì • í¼ -->
        <div class="form-container p-4">
            <h4 class="text-center" style="font-size:20px;">ìœ ì € ì •ë³´</h4>

            <form action="/admin/users/update" method="POST">
                <input id="userId" type="hidden" name="userId" th:value="${userDto.userId}">
                <input type="hidden" name="_csrf" th:value="${_csrf.token}">
                <div class="mb-3">
                    <label for="name" class="form-label">ì´ë¦„</label>
                    <input type="text" id="name" name="name" th:value="${userDto.name}" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="email" class="form-label">ì´ë©”ì¼</label>
                    <input type="email" id="email" name="email" th:value="${userDto.email}" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="phoneNumber" class="form-label">ì „í™”ë²ˆí˜¸</label>
                    <input type="text" id="phoneNumber" name="phoneNumber" th:value="${userDto.phoneNumber}" pattern="^\d{3}-\d{3,4}-\d{4}$" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="enabled" class="form-label">ê³„ì • ìƒíƒœ</label>
                    <select id="enabled" name="enabled" class="form-select">
                        <option value="true" th:selected="${userDto.enabled}">Active</option>
                        <option value="false" th:selected="${!userDto.enabled}">Inactive</option>
                    </select>
                </div>

                <p class="text-muted">íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½ ìš”ì²­ ì‹œ ì´ë©”ì¼ ë°œì†¡</p>

                <div class="d-flex justify-content-between">
                    <button type="submit" class="btn btn-primary">ìˆ˜ì •</button>
                    <button id="make-admin-btn" class="btn btn-danger">ê´€ë¦¬ì ë“±ë¡</button>
                </div>
            </form>


            <h4 class="text-center" style="font-size:20px;">í˜¸ìŠ¤íŒ… ì •ë³´</h4>
            <div th:if="${hostDto == null}" class="mt-5" style="height:250px; text-align:center;">
                <p>í˜¸ìŠ¤íŠ¸ ìœ ì €ê°€ ì•„ë‹™ë‹ˆë‹¤.</p>

                <!-- í˜¸ìŠ¤íŠ¸ ìƒì„± ë²„íŠ¼ -->
                <a th:href="@{/admin/users/create/host(userId=${userDto.userId})}" class="btn btn-primary mt-3">í˜¸ìŠ¤íŠ¸ ìƒì„±</a>
            </div>

            <form action="/admin/users/hosts/update" method="POST" th:if="${hostDto != null}">
                <input id="hostId" type="hidden" name="hostId" th:value="${hostDto.hostId}">
                <input type="hidden" name="userId" th:value="${userDto.userId}">
                <!-- ì·¨ë¯¸ -->
                <div class="mb-3">
                    <label for="hobby" class="form-label">í˜¸ìŠ¤íŠ¸ ì·¨ë¯¸</label>
                    <input type="text" id="hobby" name="hobby" th:value="${hostDto.hobby}" class="form-control">
                </div>

                <!-- ì†Œê°œ -->
                <div class="mb-3">
                    <label for="introduction" class="form-label">í˜¸ìŠ¤íŠ¸ ì†Œê°œ</label>
                    <textarea id="introduction" name="introduction" class="form-control" rows="4" th:text="${hostDto.introduction}"></textarea>
                </div>
                <input type="hidden" name="_csrf" th:value="${_csrf.token}">
                <!-- ê²€ì¦ ì—¬ë¶€ -->
                <div class="mb-3">
                    <label for="isVerified" class="form-label">ê²€ì¦ ì—¬ë¶€</label>
                    <select id="isVerified" name="isVerified" class="form-select">
                        <option value="ê²€ì¦" th:selected="${hostDto.isVerified == 'ê²€ì¦'}">ê²€ì¦</option>
                        <option value="ê²€ì¦ ì¤‘" th:selected="${hostDto.isVerified == 'ê²€ì¦ ì¤‘'}">ê²€ì¦ ì¤‘</option>
                        <option value="ë¯¸ê²€ì¦" th:selected="${hostDto.isVerified == 'ë¯¸ê²€ì¦'}">ë¯¸ê²€ì¦</option>
                    </select>
                </div>

                <!-- ê³„ì¢Œ ë²ˆí˜¸ -->
                <div class="mb-3">
                    <label for="accountNumber" class="form-label">ê³„ì¢Œ ë²ˆí˜¸</label>
                    <input type="text" id="accountNumber" name="accountNumber" th:value="${hostDto.accountNumber}" class="form-control">
                </div>

                <button type="submit" class="btn btn-primary w-30">ìˆ˜ì •</button>
            </form>

        </div>



        <!-- ìœ ì € ì¶”ê°€ ì •ë³´ -->
        <div class="info-container p-4">

            <div class="info-box border-bottom pb-3 mb-3 d-flex justify-content-between align-items-center">
                <div>
                    <h4>ğŸ“… ìµœê·¼ ì ‘ì†ì¼</h4>
                    <p class="fw-bold">2025-02-13 (ë¦¬í”„ë ˆì‹œ í† í°ìœ¼ë¡œ êµ¬í˜„?)</p>
                </div>

                <!-- ìˆ™ì†Œ ë“±ë¡ ë²„íŠ¼ -->
                <a href="/admin/rooms/create" class="btn btn-sm btn-primary">ìˆ™ì†Œ ë“±ë¡</a>
            </div>


            <div class="info-box border-bottom pb-3 mb-3">
                <h4>ğŸ  ë³´ìœ  ìˆ™ì†Œ</h4>
                <ul id="property-list" class="list-group"></ul>
                <table id="room-table" class="table table-bordered">
                    <thead class="table-white">
                    <tr>
                        <th>ìˆ™ì†Œ ì´ë¦„</th>
                        <th>ê°€ê²©</th>
                        <th>&nbsp;ì£¼ì†Œ&nbsp;&nbsp;</th>
                    </tr>

                    </thead>
                    <tbody>
                    <!-- ê²°ì œ ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ê²ƒì…ë‹ˆë‹¤. -->
                    </tbody>
                </table>

                <nav aria-label="Page navigation" class="page-nav" id="pagination-1">

                </nav>
            </div>

            <div class="info-box">
                <h4>ğŸ’³ ê²°ì œ ë‚´ì—­</h4>
                <table id="payment-table" class="table table-bordered">
                    <thead class="table-white">
                    <tr>
                        <th>ìˆ™ì†Œ ì´ë¦„</th>
                        <th>ê°€ê²©</th>
                        <th>ê²°ì œì¼</th>
                    </tr>

                    </thead>
                    <tbody>
                    <!-- ê²°ì œ ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ê²ƒì…ë‹ˆë‹¤. -->
                    </tbody>
                </table>

                <nav aria-label="Page navigation" class="page-nav" id="pagination-2">

                </nav>

                <!-- ë©”ì‹œì§€ ë³´ë‚´ëŠ” ì»´í¬ë„ŒíŠ¸ -->
                <div class="message-container mt-4">
                    <h5>ğŸ’¬ ë©”ì‹œì§€ ë³´ë‚´ê¸°</h5>
                    <form id="message-form">
                        <div class="mb-3">
                            <label for="message" class="form-label mt-1">ë©”ì‹œì§€</label>
                            <textarea id="message" name="message" class="form-control" rows="4" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">ë©”ì‹œì§€ ë³´ë‚´ê¸°</button>
                    </form>
                    <div id="message-status" class="mt-3"></div>
                </div>


            </div>
        </div>
        <!-- í˜¸ìŠ¤íŠ¸ ì˜ì—…ì‹ ê³ ì¦ ì •ë³´ -->
        <div class="info-container p-4 mt-4">
            <h4 class="text-center" style="font-size:20px;">ğŸ“„ í˜¸ìŠ¤íŠ¸ ì˜ì—…ì‹ ê³ ì¦ ì •ë³´</h4>

            <div th:if="${license == null}" class="mt-3 text-center mb-3">
                <p class="text-danger">
                    í•´ë‹¹ í˜¸ìŠ¤íŠ¸ëŠ” ì˜ì—…ì‹ ê³ ì¦ì„ ì œì¶œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                    <!-- ì˜ì—…ì‹ ê³ ì¦ ì œì¶œ ë²„íŠ¼ -->
                    <div th:if="${hostDto != null}" >
                        <a th:href="@{/admin/users/license/create(hostId=${hostDto.hostId},userId=${userDto.userId})}" class="btn btn-sm btn-primary ms-2">ì˜ì—…ì‹ ê³ ì¦ ì œì¶œ</a>
                    </div>
                </p>
            </div>


            <div th:if="${license != null}" class="mt-3">
                <!-- ì˜ì—…ì‹ ê³ ì¦ ê¸°ë³¸ ì •ë³´ -->
                <table class="table table-bordered">
                    <tbody>
                    <tr>
                        <th style="width: 30%;">í˜¸ìŠ¤íŠ¸ ID</th>
                        <td th:text="${license.hostId}"></td>
                    </tr>
                    <tr>
                        <th>ì˜ì—…ì‹ ê³ ì¦ ìœ í˜•</th>
                        <td th:text="${license.businessType}"></td>
                    </tr>
                    <tr>
                        <th>ë°œê¸‰ ì§€ì—­</th>
                        <td th:text="${license.region}"></td>
                    </tr>
                    <tr>
                        <th>ì‹ ê³ ì¦ ì œì¶œ ë‚ ì§œ</th>
                        <td th:text="${#temporals.format(license.uploadedAt, 'yyyy-MM-dd HH:mm')}"></td>
                    </tr>
                    </tbody>
                </table>

                <!-- ì˜ì—…ì‹ ê³ ì¦ ì´ë¯¸ì§€ -->
                <div class="text-center mt-3">
                    <h5>ğŸ“· ì‹ ê³ ì¦ ì´ë¯¸ì§€</h5>
                    <div class="license-image-container mt-2 mb-3">
                        <img th:src="${license.licenseFileUrl}"
                             class="img-fluid border rounded" style="max-width: 400px;"
                             alt="ì˜ì—…ì‹ ê³ ì¦ ì´ë¯¸ì§€">
                    </div>
                </div>
            </div>
        </div>

    </main>
</th:block>
<th:block layout:fragment="js">

    <!--axios-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById("message-form").addEventListener("submit", function(event) {
            event.preventDefault();  // í¼ ì œì¶œ ì‹œ í˜ì´ì§€ ìƒˆë¡œ ê³ ì¹¨ ë°©ì§€

            const message = document.getElementById("message").value;
            const userId = document.getElementById("userId").value;

            // ë©”ì‹œì§€ ë³´ë‚´ê¸° API ìš”ì²­
            axios.post('/admin/api/users/sendMessage', {
                userId: userId,
                message: message
            })
            .then(response => {
                // ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ ì‹œ
                document.getElementById("message-status").textContent = "ë©”ì‹œì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.";
                document.getElementById("message").value = "";  // ì…ë ¥ í•„ë“œ ë¹„ìš°ê¸°
            })
            .catch(error => {
                // ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨ ì‹œ
                document.getElementById("message-status").textContent = "ë©”ì‹œì§€ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
                document.getElementById("message-status").style.color = "red";
            });
        });
    </script>
    <!--ê´€ë¦¬ì ê¶Œí•œ ì¶”ê°€ ìš”ì²­-->
    <script>
        document.getElementById("make-admin-btn").addEventListener("click", function() {
            const userId = document.getElementById("userId").value;  // í˜„ì¬ ìœ ì € ID

            // ê´€ë¦¬ì ë“±ë¡ API ìš”ì²­
            axios.post('/admin/api/users/makeAdmin', {
                userId: userId  // ìœ ì € IDë¥¼ ì„œë²„ë¡œ ì „ì†¡
            })
            .then(response => {
                if (response.data.success) {
                    alert("ì„±ê³µì ìœ¼ë¡œ ê´€ë¦¬ìë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
                } else {
                    alert("ê´€ë¦¬ì ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }
            })
            .catch(error => {
                console.error("ê´€ë¦¬ì ë“±ë¡ ì˜¤ë¥˜:", error);
                alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.(ì´ë¯¸ ê´€ë¦¬ìì¼ ìˆ˜ ìˆìŒ)");
            });
        });
    </script>

    <!--ê²°ì œë‚´ì—­js-->
    <script>

        let currentPage2 = 1;
        const pageSize = 5;  // í˜ì´ì§€ë‹¹ í‘œì‹œí•  ë°ì´í„° ìˆ˜
        const userId = document.getElementById("userId").value;

        window.onload = function() {
         filterUsersPayments(); // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²°ì œ ë‚´ì—­ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
          filterUsersRooms(); // ë³´ìœ  ìˆ™ì†Œ(ë°©) ë¶ˆëŸ¬ì˜¤ê¸°
        };

        function filterUsersPayments() {

            // axiosë¥¼ ì‚¬ìš©í•´ì„œ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
            axios.get('/admin/api/users/payments', {
                params: {
                    userId: userId,   // ìœ ì €id
                    page: currentPage2,     // í˜„ì¬ í˜ì´ì§€
                    size: pageSize         // í˜ì´ì§€ í¬ê¸°
                }
            })
            .then(response => {
                const data = response.data;

                renderTable2(data.objects);  // í…Œì´ë¸”ì„ ê°±ì‹ í•©ë‹ˆë‹¤.
                renderPagination2(data);      // í˜ì´ì§€ë„¤ì´ì…˜ì„ ê°±ì‹ í•©ë‹ˆë‹¤.
            })
            .catch(error => {
                console.error("Error fetching data", error);
            });
        }

        // í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
        function renderTable2(payments) {
            const tbody = document.querySelector("#payment-table tbody");
            tbody.innerHTML = "";  // ê¸°ì¡´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”

            payments.forEach(payment => {
              const date = new Date(payment.createdAt);
              const formattedDate = date.toLocaleDateString('ko-KR');

                const row = document.createElement("tr");
                row.innerHTML = `
                      <td><a href="/admin/payments/${payment.paymentId}">${payment.roomName}</a></td>
                      <td>${payment.amount}</td>
                      <td>${formattedDate}</td>
                `;
                tbody.appendChild(row);
            });
        }


        function renderPagination2(data) {
        let paginationDiv = document.getElementById("pagination-2");
        paginationDiv.innerHTML = "";  // ê¸°ì¡´ í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”

        const currentPage = data.currentPage;  // í˜„ì¬ í˜ì´ì§€
        const totalItems = data.totalItems;    // ì „ì²´ ìœ ì € ìˆ˜
        const totalPages = data.totalPages;    // ì „ì²´ í˜ì´ì§€ ìˆ˜
        const startPage = data.startPage;      // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ì‹œì‘ í˜ì´ì§€
        const endPage = data.endPage;          // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ë í˜ì´ì§€
        const hasPrev = data.hasPrev;          // ì´ì „ í˜ì´ì§€ ì—¬ë¶€
        const hasNext = data.hasNext;          // ë‹¤ìŒ í˜ì´ì§€ ì—¬ë¶€

        currentPage2 = currentPage;
        // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ì„ ìœ„í•œ HTML ì‹œì‘
        let paginationHTML = `
            <ul class="pagination justify-content-center pagination-sm">
                <!-- ì´ì „ ë²„íŠ¼ -->
                <li class="page-item ${hasPrev ? '' : 'disabled'}">
                    <a class="page-link" href="#" aria-label="Previous" onclick="changePage2(${currentPage - 1})">Â«</a>
                </li>
        `;

        // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ë“¤
        for (let i = startPage; i <= endPage; i++) {
            paginationHTML += `
                <li class="page-item ${currentPage === i ? 'active' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                </li>
            `;
        }

        // ë‹¤ìŒ ë²„íŠ¼
        paginationHTML += `
                <li class="page-item ${hasNext ? '' : 'disabled'}">
                    <a class="page-link" href="#" aria-label="Next" onclick="changePage2(${currentPage + 1})">Â»</a>
                </li>
            </ul>
        `;

        // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ì„ DOMì— ì‚½ì…
            paginationDiv.innerHTML = paginationHTML;
        }

            function changePage2(page) {

              // í˜ì´ì§€ ë³€ê²½ ë¡œì§ (ê²€ìƒ‰ì–´ì™€ í˜ì´ì§€ í¬ê¸°, í˜ì´ì§€ ë²ˆí˜¸ ë“±)
              axios.get('/admin/api/users/payments', {
                  params: {
                      userId: userId,        // ê²€ìƒ‰ì–´
                      page: page,            // ìƒˆ í˜ì´ì§€ ë²ˆí˜¸
                      size: pageSize         // í˜ì´ì§€ í¬ê¸°
                  }
              })
              .then(response => {
                  const data = response.data;
                  renderTable2(data.objects);  // ìœ ì € ëª©ë¡ ë Œë”ë§
                  renderPagination2(data);     // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ë Œë”ë§
              })
              .catch(error => {
                  console.error("í˜ì´ì§€ë¥¼ ë¡œë“œí•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
              });
          }
    </script>
    <!--ë³´ìœ ìˆ™ì†Œ js-->
    <script>
        let currentPage1 = 1;

        // ìœ ì € ë³´ìœ  ë°© ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        function filterUsersRooms() {
            axios.get('/admin/api/users/rooms', {
                params: {
                    userId: userId,   // ìœ ì € ID
                    page: currentPage1,  // í˜„ì¬ í˜ì´ì§€
                    size: pageSize      // í˜ì´ì§€ í¬ê¸°
                }
            })
            .then(response => {
                const data = response.data;

                renderTable1(data.objects);  // ë°© í…Œì´ë¸” ê°±ì‹ 
                renderPagination1(data);      // í˜ì´ì§€ë„¤ì´ì…˜ ê°±ì‹ 
            })
            .catch(error => {
                console.error("Error fetching rooms", error);
            });
        }

        // ë°© ë°ì´í„°ë¥¼ í…Œì´ë¸”ì— ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
        function renderTable1(rooms) {
            const tbody = document.querySelector("#room-table tbody");
            tbody.innerHTML = "";  // ê¸°ì¡´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”

            rooms.forEach(room => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td><a href="/admin/rooms/detail/${room.roomId}">${room.name}</a></td>
                    <td>${room.price}</td>
                    <td>${room.address}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // ë°© í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§ í•¨ìˆ˜
        function renderPagination1(data) {
            let paginationDiv = document.getElementById("pagination-1");
            paginationDiv.innerHTML = "";  // ê¸°ì¡´ í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”

            const currentPage = data.currentPage;
            const totalPages = data.totalPages;
            const startPage = data.startPage;
            const endPage = data.endPage;
            const hasPrev = data.hasPrev;
            const hasNext = data.hasNext;

            currentPage1 = currentPage;
            let paginationHTML = `
                <ul class="pagination justify-content-center pagination-sm">
                    <li class="page-item ${hasPrev ? '' : 'disabled'}">
                        <a class="page-link" href="#" onclick="changePage1(${currentPage - 1})">Â«</a>
                    </li>
            `;

            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <li class="page-item ${currentPage === i ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage1(${i})">${i}</a>
                    </li>
                `;
            }

            paginationHTML += `
                    <li class="page-item ${hasNext ? '' : 'disabled'}">
                        <a class="page-link" href="#" onclick="changePage1(${currentPage + 1})">Â»</a>
                    </li>
                </ul>
            `;

            paginationDiv.innerHTML = paginationHTML;
        }

        // í˜ì´ì§€ ë³€ê²½ ì‹œ ë°© ëª©ë¡ì„ ë‹¤ì‹œ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        function changePage1(page) {
            axios.get('/admin/api/users/rooms', {
                params: {
                    userId: userId,
                    page: page,
                    size: pageSize
                }
            })
            .then(response => {
                const data = response.data;
                renderTable1(data.objects);
                renderPagination1(data);
            })
            .catch(error => {
                console.error("í˜ì´ì§€ë¥¼ ë¡œë“œí•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
            });
        }

        //ë©”ì‹œì§€ ë³´ë‚´ëŠ” js
        document.getElementById("message-form").addEventListener("submit", function(event) {
            event.preventDefault();  // í¼ ì œì¶œ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë°©ì§€

            const message = document.getElementById("message").value.trim();
            const userId = document.getElementById("userId").value; // ëŒ€ìƒ ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸°

            if (!message) {
                alert("ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                return;
            }

            // CSRF í† í° ê°€ì ¸ì˜¤ê¸° (ë³´ì•ˆ ì„¤ì •ì´ ì ìš©ëœ ê²½ìš°)
            const csrfToken = document.querySelector('meta[name="_csrf"]')?.getAttribute("content");
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]')?.getAttribute("content");

            // ë©”ì‹œì§€ ì „ì†¡ API ìš”ì²­
            axios.post('/admin/api/send-user', {
                userId: userId,
                message: message
            }, {
                headers: {
                    "Content-Type": "application/json",
                    [csrfHeader]: csrfToken  // CSRF í† í° ì¶”ê°€ (CSRF ë³´í˜¸ í™œì„±í™”ëœ ê²½ìš°)
                }
            })
            .then(response => {
                // ì„±ê³µ ì‹œ ë©”ì‹œì§€ í‘œì‹œ
                document.getElementById("message-status").textContent = response.data.message;
                document.getElementById("message-status").style.color = "green";
                document.getElementById("message").value = "";  // ì…ë ¥ í•„ë“œ ë¹„ìš°ê¸°
            })
            .catch(error => {
                console.error("ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:", error);

                // ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
                document.getElementById("message-status").textContent = "ë©”ì‹œì§€ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
                document.getElementById("message-status").style.color = "red";
            });
        });

    </script>
</th:block>

</body>
</html>
