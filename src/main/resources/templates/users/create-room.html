<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base/layout-sample}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìˆ™ì†Œ ë“±ë¡</title>
  <th:block layout:fragment="css">
  <!-- âœ… ì¹´ì¹´ì˜¤ ì§€ë„ API -->
  <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=b885630c0823c3db8c4b7d8da74981dd&libraries=services"></script>
  <!-- âœ… ì¹´ì¹´ì˜¤ ì£¼ì†Œ ê²€ìƒ‰ API -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

  <style>
    body {
        background-color: #f8f9fa;
    }
    .container {
        max-width: 900px;
        margin-top: 50px;
    }
    .header-title {
        font-weight: bold;
        font-size: 1.5rem;
    }
    #map {
        width: 100%;
        height: 300px;
        border-radius: 8px;
        border: 1px solid #ddd;
        margin-top: 10px;
    }

  </style>
  </th:block>
</head>
<body>
<th:block layout:fragment="content">

  <main class="main-content">
<div class="container">
  <h2 class="header-title text-center">ğŸ  ìˆ™ì†Œ ë“±ë¡</h2>
  <p class="text-center text-muted">ìˆ™ì†Œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>

  <form action="/admin/rooms/create" method="post" enctype="multipart/form-data">
    <div class="row">
      <!-- âœ… ì™¼ìª½: ì£¼ì†Œ ê²€ìƒ‰ ë° ì§€ë„ -->
      <div class="col-md-6">

        <input type="hidden" name="_csrf" th:value="${_csrf.token}">
        <input type="hidden" name="userId" th:value="${userId}">
        <!-- ì£¼ì†Œ ê²€ìƒ‰ -->
        <div class="mb-3">
          <label for="address" class="form-label">ğŸ“ ìˆ™ì†Œ ì£¼ì†Œ</label>
          <div class="input-group">
            <input type="text" class="form-control" id="address" name="address" readonly required>
            <button type="button" class="btn btn-primary" onclick="openAddressSearch()">ì£¼ì†Œ ê²€ìƒ‰</button>
          </div>
        </div>

        <!-- ìœ„ë„ / ê²½ë„ ì •ë³´ -->
        <div class="row">
          <div class="col-md-6">
            <label for="latitude">ğŸŒ ìœ„ë„ (Latitude)</label>
            <input type="text" class="form-control" id="latitude" name="latitude" readonly>
          </div>
          <div class="col-md-6">
            <label for="longitude">ğŸŒ ê²½ë„ (Longitude)</label>
            <input type="text" class="form-control" id="longitude" name="longitude" readonly>
          </div>
        </div>

        <!-- ì§€ë„ í‘œì‹œ -->
        <div id="map"></div>

        <div class="mb-3 mt-3">
          <label for="buildingType" class="form-label">ê±´ë¬¼ ìœ í˜•</label>
          <select class="form-select" id="buildingType" name="buildingType" required>
            <option value="ì•„íŒŒíŠ¸">ì•„íŒŒíŠ¸</option>
            <option value="ì£¼íƒ">ì£¼íƒ</option>
            <option value="ë¹Œë¼">ë¹Œë¼</option>
          </select>
        </div>
      </div>

      <!-- âœ… ì˜¤ë¥¸ìª½: ìˆ™ì†Œ ì •ë³´ ì…ë ¥ -->
      <div class="col-md-6">
        <div class="mb-3">
          <label for="title" class="form-label">ìˆ™ì†Œ ì œëª©</label>
          <input type="text" class="form-control" id="title" name="title" required>
        </div>

        <div class="mb-3">
          <label for="name" class="form-label">ìˆ™ì†Œ ì´ë¦„</label>
          <input type="text" class="form-control" id="name" name="name" required>
        </div>
        <div class="mb-3 mt-3">
          <label for="useGuide" class="form-label">ğŸ“– ìˆ™ë°• ì´ìš© ì•ˆë‚´</label>
          <textarea class="form-control" id="useGuide" name="useGuide" rows="3"></textarea>
        </div>

        <div class="mb-3">
          <label for="content" class="form-label">ìˆ™ì†Œ ì„¤ëª…</label>
          <textarea class="form-control" id="content" name="content" rows="3" required></textarea>
        </div>

        <div class="mb-3">
          <label for="price" class="form-label">ìˆ™ë°• ê°€ê²© (â‚©)</label>
          <input type="number" class="form-control" id="price" name="price" required>
        </div>


      </div>
    </div>

    <!-- âœ… ì¹¨ì‹¤, ì¹¨ëŒ€, ìš•ì‹¤ ê°œìˆ˜ -->
    <div class="row mt-3">
      <div class="col-md-3">
        <label for="maxGuests" class="form-label">ìµœëŒ€ ìˆ™ë°• ì¸ì›</label>
        <input type="number" class="form-control" id="maxGuests" name="maxGuests" min="0" required>
      </div>
      <div class="col-md-3">
        <label for="bedrooms" class="form-label">ì¹¨ì‹¤ ê°œìˆ˜</label>
        <input type="number" class="form-control" id="bedrooms" name="bedrooms" min="0" required>
      </div>
      <div class="col-md-3">
        <label for="beds" class="form-label">ì¹¨ëŒ€ ê°œìˆ˜</label>
        <input type="number" class="form-control" id="beds" name="beds" min="0" required>
      </div>
      <div class="col-md-3">
        <label for="bathrooms" class="form-label">ìš•ì‹¤ ê°œìˆ˜</label>
        <input type="number" class="form-control" id="bathrooms" name="bathrooms" min="0" required>
      </div>
    </div>


    <!-- âœ… ìˆ™ì†Œ ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
    <!-- âœ… ìˆ™ì†Œ ì´ë¯¸ì§€ ì—…ë¡œë“œ (ë‹¤ì¤‘ íŒŒì¼ ì„ íƒ ê°€ëŠ¥) -->
    <div class="mb-3 mt-3">
      <label for="roomImages" class="form-label">ìˆ™ì†Œ ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
      <input type="file" class="form-control" id="roomImages" name="roomImages" accept="image/*" multiple required>
    </div>


    <!-- âœ… ì œì¶œ ë²„íŠ¼ -->
    <button type="submit" class="btn btn-primary w-100 mt-3">ì¹´í…Œê³ ë¦¬ ë° ì˜µì…˜ ì„¤ì •</button>
  </form>
</div>
  </main>
</th:block>

</body>
<th:block layout:fragment="js">

<script>
  var map, geocoder, marker;

  function initMap() {
      console.log("ğŸš€ ì§€ë„ ë¡œë”© ì¤‘...");
      var defaultLocation = new kakao.maps.LatLng(37.5665, 126.9780); // ì´ˆê¸° ìœ„ì¹˜ (ì„œìš¸ ì‹œì²­)

      map = new kakao.maps.Map(document.getElementById('map'), {
          center: defaultLocation,
          level: 3 // ì§€ë„ í™•ëŒ€ ë ˆë²¨
      });

      geocoder = new kakao.maps.services.Geocoder();
      marker = new kakao.maps.Marker({ position: defaultLocation, map: map });

      console.log("âœ… ì§€ë„ ë¡œë”© ì™„ë£Œ!");
  }

  function openAddressSearch() {
      console.log("ğŸ“ ì£¼ì†Œ ê²€ìƒ‰ ì‹¤í–‰");
      new daum.Postcode({
          oncomplete: function(data) {
              var fullAddress = data.roadAddress || data.jibunAddress;
              document.getElementById("address").value = fullAddress;

              // âœ… ì£¼ì†Œ â†’ ìœ„ë„/ê²½ë„ ë³€í™˜
              geocoder.addressSearch(fullAddress, function(result, status) {
                  if (status === kakao.maps.services.Status.OK) {
                      var latlng = new kakao.maps.LatLng(result[0].y, result[0].x);
                      document.getElementById("latitude").value = result[0].y;
                      document.getElementById("longitude").value = result[0].x;

                      // âœ… ì§€ë„ ì´ë™ ë° ë§ˆì»¤ í‘œì‹œ
                      map.setCenter(latlng);
                      marker.setPosition(latlng);

                      console.log("ğŸ—º ì§€ë„ ìœ„ì¹˜ ì—…ë°ì´íŠ¸: " + fullAddress);
                  } else {
                      alert("âš  ìœ„ë„/ê²½ë„ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                  }
              });
          }
      }).open();
  }

  window.onload = function() {
      initMap();
  };
</script>
</th:block>
</html>
