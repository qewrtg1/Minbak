<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¹´í…Œê³ ë¦¬ ë° ì˜µì…˜ ì„ íƒ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- âœ… ì¹´ì¹´ì˜¤ ì§€ë„ API -->
  <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=b885630c0823c3db8c4b7d8da74981dd&libraries=services"></script>

  <style>
    body {
        background-color: #f8f9fa;
    }

    .room-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-top: 20px;
    }

    .room-image {
        width: 100%;
        height: auto;
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .category-button, .option-button {
        display: inline-block;
        margin: 5px;
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        background-color: white;
        transition: all 0.2s ease-in-out;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
    }

    .category-button:hover, .option-button:hover {
        background-color: #f1f1f1;
    }

    .selected {
        background-color: #80bfff !important;
        color: white !important;
        border-color: #0056b3;
        font-weight: bold;
    }

    .submit-btn {
        background-color: #007bff;
        color: white;
        font-size: 1.2rem;
        padding: 10px;
        border-radius: 8px;
    }

    /* âœ… ì§€ë„ ìŠ¤íƒ€ì¼ */
    #map {
        width: 100%;
        height: 300px;
        border-radius: 10px;
        border: 1px solid #ddd;
        margin-top: 15px;
    }
  </style>
</head>
<body>

<div class="container mt-5">
  <h2 class="text-center mb-4">ğŸ  ìˆ™ì†Œ ì •ë³´ ë° ì¹´í…Œê³ ë¦¬/ì˜µì…˜ ì„¤ì •</h2>

  <div class="row">
    <!-- âœ… ì™¼ìª½: ìˆ™ì†Œ ì •ë³´ -->
    <div class="col-md-5">
      <div class="room-card">
        <h4 class="mb-3">ğŸ¡ ìˆ™ì†Œ ì •ë³´</h4>

        <table class="table table-bordered">
          <tbody>
          <tr>
            <th>ìˆ™ì†Œ ì œëª©</th>
            <td th:text="${room.title}"></td>
          </tr>
          <tr>
            <th>ìˆ™ì†Œ ì´ë¦„</th>
            <td th:text="${room.name}"></td>
          </tr>
          <tr>
            <th>ì£¼ì†Œ</th>
            <td th:text="${room.address}"></td>
          </tr>
          <tr>
            <th>ê°€ê²©</th>
            <td th:text="|â‚© ${#numbers.formatInteger(room.price, 0, 'COMMA')}|"></td>
          </tr>
          <tr>
            <th>ê±´ë¬¼ ìœ í˜•</th>
            <td th:text="${room.buildingType}"></td>
          </tr>
          <tr>
            <th>ìµœëŒ€ ì¸ì›</th>
            <td th:text="${room.maxGuests}"></td>
          </tr>
          <tr>
            <th>ì¹¨ì‹¤/ì¹¨ëŒ€/ìš•ì‹¤</th>
            <td th:text="|${room.bedrooms}ê°œ / ${room.beds}ê°œ / ${room.bathrooms}ê°œ|"></td>
          </tr>
          <tr>
            <th>ìœ„ë„/ê²½ë„</th>
            <td th:text="|${room.latitude}, ${room.longitude}|"></td>
          </tr>
          </tbody>
        </table>
        <!-- âœ… ìœ„ë„/ê²½ë„ ê°’ì„ hidden inputìœ¼ë¡œ ì„¤ì • -->
        <input type="hidden" id="latitude" th:value="${room.latitude}">
        <input type="hidden" id="longitude" th:value="${room.longitude}">

        <!-- âœ… ì§€ë„ í‘œì‹œ -->
        <h5 class="mt-3">ğŸ—º ìˆ™ì†Œ ìœ„ì¹˜</h5>
        <div id="map"></div>
      </div>
    </div>

    <!-- âœ… ì˜¤ë¥¸ìª½: ì¹´í…Œê³ ë¦¬ ë° ì˜µì…˜ ì„ íƒ -->
    <div class="col-md-7">
      <form th:action="@{/admin/rooms/{roomId}/categories-options(roomId=${roomId})}" method="post">
        <input type="hidden" name="roomId" th:value="${roomId}">
        <input type="hidden" name="_csrf" th:value="${_csrf.token}">

        <!-- âœ… ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
        <h4 class="mt-4">ğŸ“Œ ì¹´í…Œê³ ë¦¬ ì„ íƒ</h4>
        <div class="d-flex flex-wrap">
          <button type="button" class="category-button"
                  th:each="category : ${categories}"
                  th:data-category-id="${category.categoryId}"
                  th:text="${category.name}"
                  onclick="toggleCategory(this)">
          </button>
        </div>
        <input type="hidden" name="categoryIds" id="selectedCategories">

        <!-- âœ… ì˜µì…˜ ì„ íƒ -->
        <h4 class="mt-4">âš™ï¸ ì˜µì…˜ ì„ íƒ</h4>
        <div th:each="entry : ${optionsByCategory}" class="mt-3">
          <h5 th:text="${entry.key}">ì˜µì…˜ ì¹´í…Œê³ ë¦¬</h5>
          <div class="d-flex flex-wrap">
            <button type="button" class="option-button"
                    th:each="option : ${entry.value}"
                    th:data-option-id="${option.optionId}"
                    th:text="${option.name}"
                    onclick="toggleOption(this)">
            </button>
          </div>
        </div>
        <input type="hidden" name="optionIds" id="selectedOptions">

        <!-- âœ… ì œì¶œ ë²„íŠ¼ -->
        <button type="submit" class="btn submit-btn w-100 mt-4">ë“±ë¡ ì™„ë£Œ</button>
      </form>
    </div>
  </div>
</div>

<script>
  function toggleCategory(button) {
      button.classList.toggle('selected');

      let selectedCategories = [];
      document.querySelectorAll('.category-button.selected').forEach(btn => {
          selectedCategories.push(btn.getAttribute('data-category-id'));
      });
      document.getElementById('selectedCategories').value = selectedCategories.join(",");
  }

  function toggleOption(button) {
      button.classList.toggle('selected');

      let selectedOptions = [];
      document.querySelectorAll('.option-button.selected').forEach(btn => {
          selectedOptions.push(btn.getAttribute('data-option-id'));
      });
      document.getElementById('selectedOptions').value = selectedOptions.join(",");
  }

  // âœ… ì¹´ì¹´ì˜¤ ì§€ë„ ë¡œë”©
  function initMap() {
      var latitude = parseFloat(document.getElementById("latitude").value);
      var longitude = parseFloat(document.getElementById("longitude").value);

      var mapContainer = document.getElementById('map');
      var mapOption = {
          center: new kakao.maps.LatLng(latitude, longitude),
          level: 3
      };

      var map = new kakao.maps.Map(mapContainer, mapOption);
      var marker = new kakao.maps.Marker({
          position: mapOption.center
      });

      marker.setMap(map);
  }

  window.onload = function() {
      initMap();
  };
</script>

</body>
</html>
