<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Maps with Search and Icon</title>
  <!-- Google Maps API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA50X20VvIVk9sELnewUrtok0ZJYWrtVzE&libraries=places&callback=initMap" async defer></script>
  <!-- FontAwesome (for the search icon) -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    /* 전체 페이지 레이아웃 */
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }

    #map {
    width: 800px;
    height: 800px;
    margin: 0 auto;
    display: block;
}

    /* 검색창 스타일 */
    .search-container {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        width: 400px;
        display: flex;
        align-items: center;
        background-color: white;
        border-radius: 25px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .search-container input {
        width: 100%;
        padding: 10px;
        padding-left: 35px; /* 아이콘을 위한 여백 */
        border: none;
        border-radius: 25px;
        font-size: 16px;
        box-sizing: border-box;
    }

    .search-container i {
        position: absolute;
        left: 10px; /* 아이콘 위치 */
        font-size: 20px;
        color: #777;
    }

    /* 버튼 스타일 */
    .current-location-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .current-location-btn:hover {
        background-color: #0056b3;
    }

    #address-info {
        display: none;
        position: absolute;
        top: 80px;
        right: 150px;
        width: 300px;
        background-color: white;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 10;
}
     #address-info label {
        display: block;
        margin-bottom: 8px;
        font-size: 14px;
    }
    #address-info input {
        width: 100%;
        padding: 5px;
        font-size: 14px;
        margin-top: 2px;
    }
  </style>
</head>
<body>
<!-- 현재 위치 버튼 -->
<button class="current-location-btn" onclick="getCurrentLocation()">현재 위치 정보</button>

<!-- 지도 -->
<div id="map"></div>

<!-- 검색창 -->
<div class="search-container">
  <i class="fas fa-search"></i> <!-- 검색 아이콘 -->
  <input type="text" id="address" placeholder="주소를 입력하세요.">
</div>

<!-- 주소 세부 정보 -->
<div id="address-info">
  <label>도/특별-광역시: <input type="text" id="province"></label>
  <label>도시: <input type="text" id="city"></label>
  <label>군/구: <input type="text" id="district"></label>
  <label>도로명 주소: <input type="text" id="road-address"></label>
  <label>아파트 층수/호수: <input type="text" id="apartment"></label>
  <label>건물명: <input type="text" id="building-name"></label>
  <label>우편번호: <input type="text" id="postal-code"></label>
</div>

<script>
  let map, marker, searchBox;

  function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 37.5665, lng: 126.9788 }, // 서울 중심
      zoom: 15,
    });

    marker = new google.maps.Marker({
      map: map,
      position: { lat: 37.5665, lng: 126.9788 },
      title: "현재 위치",
    });

    // 검색창 초기화
    searchBox = new google.maps.places.SearchBox(document.getElementById('address'));

    // 지도 경계 변경 시 검색창 범위 설정
    map.addListener('bounds_changed', function() {
      searchBox.setBounds(map.getBounds());
    });

    // 검색 결과가 선택되었을 때 처리
    searchBox.addListener('places_changed', function() {
      const places = searchBox.getPlaces();
      if (places.length == 0) return;
      const place = places[0];
      if (!place.geometry) return;

      map.setCenter(place.geometry.location);
      marker.setPosition(place.geometry.location);
      displayAddressInfo(place);
    });

    // 지도 클릭 시 해당 위치로 마커 이동 및 주소 정보 업데이트
    map.addListener('click', function(event) {
      marker.setPosition(event.latLng);
      const geocoder = new google.maps.Geocoder();
      geocoder.geocode({ location: event.latLng }, function(results, status) {
        if (status === google.maps.GeocoderStatus.OK) {
          displayAddressInfo(results[0]);
        }
      });
    });
  }

  // 현재 위치 불러오기 함수
  function getCurrentLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        const latLng = { lat: position.coords.latitude, lng: position.coords.longitude };
        map.setCenter(latLng);
        marker.setPosition(latLng);
        const geocoder = new google.maps.Geocoder();
        geocoder.geocode({ location: latLng }, function(results, status) {
          if (status === google.maps.GeocoderStatus.OK) {
            displayAddressInfo(results[0]);
          }
        });
      }, function() {
        alert("현재 위치를 가져올 수 없습니다.");
      });
    } else {
      alert("이 브라우저에서는 Geolocation을 지원하지 않습니다.");
    }
  }

  // 주소 정보를 input 필드에 출력하여 사용자가 수정할 수 있도록 함
  function displayAddressInfo(place) {
    document.getElementById('address-info').style.display = 'block';
    const addressComponents = place.address_components;
    addressComponents.forEach(component => {
      const types = component.types;
      if (types.includes("administrative_area_level_1")) {
        document.getElementById('province').value = component.long_name;
      }
      if (types.includes("locality")) {
        document.getElementById('city').value = component.long_name;
      }
      if (types.includes("sublocality_level_1")) {
        document.getElementById('district').value = component.long_name;
      }
      if (types.includes("route")) {
        document.getElementById('road-address').value = component.long_name;
      }
      if (types.includes("premise")) {
        document.getElementById('apartment').value = component.long_name;
      }
      if (types.includes("building")) {
        document.getElementById('building-name').value = component.long_name;
      }
      if (types.includes("postal_code")) {
        document.getElementById('postal-code').value = component.long_name;
      }
    });
  }
</script>
</body>
</html>