<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>메시지</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .message-container { height: 100vh; }
    .message-list { background-color: #f8f9fa; padding: 15px; overflow-y: auto; border-right: 1px solid #ddd; }
    .chat-content { background-color: #fff; padding: 15px; }
    .user-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #ddd; display: flex; align-items: center; }
    .user-item:hover { background-color: #e9ecef; }
    .chat-messages { height: 65vh; overflow-y: auto; padding: 10px; }
    .message { padding: 10px; border-radius: 10px; margin-bottom: 10px; max-width: 75%; }
    .received { background-color: #f1f1f1; align-self: flex-start; }
    .sent { background-color: #007bff; color: white; align-self: flex-end; }
    .chat-input { margin-top: 15px; display: flex; }
    .chat-input input { flex-grow: 1; margin-right: 10px; }
    .chat-header { border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 10px; }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row message-container">
    <!-- 왼쪽 패널 (유저 메시지 목록) -->
    <div class="col-3 message-list">
      <div class="d-flex justify-content-between align-items-center">
        <h4>메시지</h4>
        <div>
          <button class="btn btn-dark btn-sm">전체</button>
          <button class="btn btn-outline-dark btn-sm">읽지 않음</button>
        </div>
      </div>
      <div class="user-list mt-3">
        <div class="user-item" th:each="userMessageList : ${userMessageLists}" th:attr="data-chat-id=${userMessageList.chatRoomId}" onclick="loadChat(this)">
          <img src="챗룸아이디 상대방 이미지링크" alt="User Icon" width="40" height="40" class="me-2">
          <div>
            <h6 th:text="${userMessageList.ChatRoomUserName}">유저 이름</h6>
            <p class="text-muted small" th:text="${chat.lastMessageContent}">마지막 메시지</p>
          </div>
          <span class="text-muted small ms-auto" th:text="${chat.lastMessageTime}">2.20.</span>
        </div>
      </div>
    </div>

    <!-- 중앙 패널 (대화 내용) -->
    <div class="col-9 chat-content d-flex flex-column">
      <div class="chat-header">
        <h4 th:text="${selectedChat.userName}">선택된 유저</h4>
      </div>
      <div class="chat-messages d-flex flex-column">
        <div class="message received" th:each="msg : ${messages}" th:if="${msg.sender != 'me'}">
          <p th:text="${msg.content}">상대 메시지</p>
          <span class="text-muted small" th:text="${msg.sentAt}">11:06</span>
        </div>
        <div class="message sent align-self-end" th:each="msg : ${messages}" th:if="${msg.sender == 'me'}">
          <p th:text="${msg.content}">내 메시지</p>
          <span class="text-light small" th:text="${msg.sentAt}">11:06</span>
        </div>
      </div>
      <div class="chat-input">
        <input type="text" class="form-control" placeholder="메시지를 입력하세요..." id="messageInput">
        <button class="btn btn-primary" onclick="sendMessage()">전송</button>
      </div>
    </div>
  </div>
</div>

<script>
  function loadChat(element) {
      let chatRoomId = element.getAttribute("data-chat-id");
      window.location.href = '/user/messageList?chatRoomId=' + chatRoomId;
  }

  function sendMessage() {
      let messageInput = document.getElementById("messageInput");
      let message = messageInput.value;
      if (message.trim() === "") return;

      // 서버 API로 메시지 전송 (AJAX 사용 가능)
      console.log("보낸 메시지:", message);
      messageInput.value = "";
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
