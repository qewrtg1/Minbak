<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>예약한 숙소 상세보기</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* 메인 컨테이너 설정 */
    .main-container {
        display: flex;
        height: 100vh;
    }

    /* 왼쪽 스크롤 가능한 예약 상세 정보 */
    .details-container {
        width: 50%;
        overflow-y: auto;
        padding: 20px;
    }

    /* 오른쪽 고정된 지도 */
    .map-container {
        width: 50%;
        position: sticky;
        top: 0;
        height: 100vh;
    }

    /* 숙소 이미지 스타일 */
    .room-image {
        width: 100%;
        height: 300px;
        object-fit: cover;
        border-radius: 8px;
    }

    /* 호스트 정보 */
    .host-info {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .host-img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
    }
  </style>
</head>
<body>

<div class="main-container">
  <!-- 왼쪽: 예약 상세 정보 -->
  <div class="details-container">
    <a href="#" class="text-decoration-none">&larr; 뒤로가기</a>

    <h2 class="mt-3" th:text="${book.room.name}">숙소 이름</h2>

    <div class="host-info mt-2">
            <img th:src="${book.userUrl}" alt="호스트 이미지" class="host-img">
      <div>
        <p class="mb-0 fw-bold" th:text="${book.user.name}">호스트 이름</p>
        <p class="text-muted small">호스트 소개 : <span th:text="${host.introduction}">3</span>년</p>
        <p class="text-muted small">호스트 경험 : <span id="hostExperience">3</span>년</p>
      </div>
    </div>

    <!-- 숙소 이미지 -->
    <div th:each="roomUrl : ${book.roomUrls}">
      <img th:src="${roomUrl}" alt="숙소 이미지" class="room-image mt-3">
    </div>

    <!-- 체크인/체크아웃 정보 -->
    <div class="mt-4 p-3 border rounded">
      <h5>체크인 / 체크아웃</h5>
      <p>체크인: <strong th:text="${#temporals.format(book.startDate, 'yyyy년 M월 d일')}">9월 30일 (금)</strong> 오후 3:00</p>
      <p>체크아웃: <strong th:text="${#temporals.format(book.endDate, 'yyyy년 M월 d일')}">10월 1일 (토)</strong> 오전 11:00</p>
    </div>

    <!-- 예약 상태 -->
    <div class="mt-3 p-3 border rounded">
      <h5>예약 상태</h5>
      <p th:text="${book.status}">확정됨</p>
      <p>결제 : <span th:text="${book.payment.status}">확정됨</span></p>
    </div>

    <!-- 요금 정보 -->
    <div class="mt-3 p-3 border rounded">
      <h5>요금 상세</h5>
      <p>숙박 요금: ₩
<!--        <span th:text="${book.room.price}">200,000-->
<!--      </span> x <span th:text="${#temporals.between(book.startDate, book.endDate, 'days')}">1</span>박--></p>
<!--      <p>청소비: ₩<span th:text="${book.cleaningFee}">30,000</span></p>-->
<!--      <p>서비스 수수료: ₩<span th:text="${book.serviceFee}">10,000</span></p>-->
      <hr>
<!--      <h5>총액: ₩<span th:text="${book.totalPrice}">240,000</span></h5>-->
    </div>

    <!-- 결제 상태  결제 데이터 불러와야함-->
    <div class="mt-3 p-3 border rounded">
      <h5>결제 상태</h5>
      <!--      <p th:text="${book.paymentStatus}">결제 완료</p>-->
    </div>

    <div class="container mt-4">
      <div class="p-3 border rounded d-flex align-items-center">
        <i class="bi bi-chat-dots me-2"></i>
        <div>
          <p class="mb-0 fw-bold">호스트에게 메시지 보내기</p>
          <p class="text-muted small" th:text="${book.user.name}">키다리여우</p>
        </div>
      </div>
    </div>

    <div class="container mt-3">
      <div class="p-3 border rounded d-flex align-items-center">
        <i class="bi bi-house-door me-2"></i>
        <div>
          <p class="mb-0 fw-bold">숙소</p>
          <p class="text-muted small" th:text="${book.room.name}">S1독실</p>
        </div>
      </div>
    </div>
    <div class="container mt-3 p-3 border rounded">
      <h5 class="fw-bold">예약 세부정보</h5>

      <p class="mb-1">🧑‍🤝‍🧑 <strong>게스트:</strong> <span th:text="${book.guestsNum}">2</span>명</p>

      <p class="mb-1">🔢 <strong>예약 번호:</strong> <span th:text="${book.bookId}">HMK92MCJK</span></p>
    </div>
    <div class="container mt-3 p-3 border rounded">
      <h5 class="fw-bold">환불 정책</h5>
      <p>
        체크인 시간인 <strong th:text="${#temporals.format(book.startDate, 'M월 d일')}">9월 30일 오후 12:00</strong> 전까지 취소하면
        부분 환불을 받을 수 있습니다. 그 이후에 취소하면 예약 대금이 환불되지 않습니다.
      </p>
      <a href="#" class="text-decoration-none">자세히 알아보기</a>
    </div>
    <div class="container mt-3">
      <button class="btn btn-outline-secondary w-100 mb-2">📄 여행 일정표 PDF로 받기 (비자 신청용)</button>
      <button class="btn btn-outline-secondary w-100 mb-2">🔍 세부정보 인쇄하기</button>
      <button class="btn btn-outline-secondary w-100">💰 영수증 받기</button>
    </div>
    <div class="container mt-4 p-3 border rounded">
      <h5 class="fw-bold">숙소 이용규칙 및 안내</h5>

      <!-- 숙소 형태 -->
      <div class="mt-3">
        <h6 class="fw-bold">숙소 형태</h6>
        <p >숙소 타입: <span th:text="${book.room.buildingType}"></span></p>
        <p >침실: <span th:text="${book.room.bedrooms}"></span></p>
        <p >침대: <span th:text="${book.room.beds}"></span></p>
        <p >화장실: <span th:text="${book.room.bathrooms}"></span></p>
        <a href="#" class="text-decoration-none">더 보기</a>
      </div>

      <hr>

      <!-- 숙소 이용규칙 -->
      <div class="mt-3">
        <h6 class="fw-bold">숙소 이용규칙</h6>
        <p th:text="${book.room.useGuide}">
          셀프 체크인: 키패드<br>
          게스트 정원: 3명<br>
          반려동물 동반 불가
        </p>
        <a href="#" class="text-decoration-none">더 보기</a>
      </div>

      <hr>

      <!-- 숙소 보기 버튼 -->
      <button class="btn btn-outline-secondary w-100">🏠 숙소 보기</button>
    </div>
    <div class="container mt-4 p-3 border rounded">
      <h5 class="fw-bold">호스트: <span th:text="${book.user.name}">키다리여우님</span></h5>

      <!-- 호스트 소개  호스트 id랑 연결해야함-->
      <div class="mt-3">
        <h6 class="fw-bold">호스트 소개</h6>
        <!--        <p th:text="${book.user.introduction}">-->
        경주스러운 분위기로 게스트님의 여행을 도와드리겠습니다.
        </p>
        <a href="#" class="text-decoration-none">더 보기</a>
      </div>

      <hr>

      <!-- 공동 호스트 정보 구현 x하지않을까 -->
      <div class="mt-3">
        <h6 class="fw-bold">공동 호스트</h6>
        <!--        <p th:text="${booking.host.cohosts}">기본좋은 사람</p>-->
      </div>

      <hr>

      <!-- 호스트 가이드북 버튼 -->
      <button class="btn btn-outline-secondary w-100">📖 호스트 가이드북</button>
    </div>
    <div class="container mt-4 p-3 border rounded">
      <h5 class="fw-bold">결제 정보</h5>
      <!--결제 금액 결제랑 연결해야함-->
      <!--      <p class="mt-2">💰 <strong>결제한 금액:</strong> ₩<span th:text="${book.totalPaid}">127,082.00</span></p>-->

      <hr>

      <!-- 영수증 받기 버튼 -->
      <button class="btn btn-outline-secondary w-100">🧾 영수증 받기</button>
    </div>
    <div class="container mt-4 p-3 border rounded">
      <h5 class="fw-bold">언제든 도움을 받으세요</h5>
      <p class="text-muted small">
        도움이 필요하신가요? 전 세계 어디서든 연중무휴로 지원해드립니다.
      </p>

      <hr>

      <!-- 고객 지원 링크 -->
      <a href="#" class="d-block text-decoration-none py-2">📞 에어비앤비 고객지원 팀에 연락하기</a>
      <a href="#" class="d-block text-decoration-none py-2">📚 도움말 센터 방문하기</a>
    </div>

  </div>

  <!-- 오른쪽: 지도 -->
  <div class="map-container">
    <div id="map" style="width: 100%; height: 100%;"></div>
  </div>
</div>

<!-- Google Maps API -->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap"></script>
<script>
  function initMap() {
      var roomLocation = {
          lat: 35.8446,  // 상수값 (예: 경주의 위도)
          lng: 129.2117   // 상수값 (예: 경주의 경도)
      };

      var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 14,
          center: roomLocation
      });

      var marker = new google.maps.Marker({
          position: roomLocation,
          map: map,
          title: '숙소 위치'
      });
  }
</script>
<!--날짜 계산 스크립트-->
<script>
  // Thymeleaf에서 전달된 문자열을 JavaScript Date 객체로 변환
  let startDate = new Date([[${book.startDate}]]);
  let endDate = new Date([[${book.endDate}]]);
  let createdAt= new Date([[${host.createdAt}]]);

  // 현재 날짜와 전달된 날짜 비교
  const currentDate = new Date();

  // 호스트 경험 날짜 계산
  let hostExperienceTime = (currentDate - createdAt) / (1000 * 3600 * 24);

  console.log("호스트경험", hostExperienceTime);

  // 두 날짜의 차이 계산 (날짜 차이: 밀리초 단위)
  let dateDiff = endDate - startDate;
  let daysDiff = dateDiff / (1000 * 3600 * 24);  // 밀리초를 일수로 변환

  console.log("현재 날짜와 주문 날짜의 차이: ", daysDiff, "일");

   document.getElementById("hostExperience").textContent = "호스트 경험 일수: " + hostExperienceTime + "일";



</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>