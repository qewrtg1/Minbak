
<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <title>숙소 메인 페이지</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* 컨테이너 너비 조정 (좌우 여백 줄이기) */
    .container {
        max-width: 90%;
    }
    /* ✅ 검색창 스타일 */
    .search-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: white;
        padding: 12px 20px;
        border-radius: 50px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        max-width: 700px;
        margin: 30px auto;
    }

    .search-input {
        flex: 1;
        border: none;
        outline: none;
        font-size: 14px;
        color: #333;
        padding: 5px 10px;
        background: transparent;
    }

    .search-button {
        background: #ff385c;
        color: white;
        border: none;
        padding: 10px 14px;
        border-radius: 50%;
        font-size: 16px;
        cursor: pointer;
    }

    .search-button:hover {
        background: #e12b50;
    }

    /* ✅ 카테고리 바 스타일 */
    .category-container {
        display: flex;
        flex-wrap: nowrap; /* 줄바꿈 방지 */
        overflow-x: hidden; /* 🔥 X축 스크롤바 완전 제거 */
        scrollbar-width: none; /* Firefox */
        -webkit-overflow-scrolling: touch;
        width: 100%;
        gap: 15px;
    }

    .category-container::-webkit-scrollbar {
        display: none; /* 🔥 Chrome, Safari 등에서 스크롤바 숨김 */
    }


    .category-container::-webkit-scrollbar-thumb {
        background-color: #ccc;
        border-radius: 10px;
    }

    .category-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        font-size: 14px;
        cursor: pointer;
        min-width: 100px; /* 최소 크기 설정 */
        text-align: center;
        flex-shrink: 0; /* 크기 줄어들지 않도록 설정 */
    }

    .category-item i {
        font-size: 20px;
        margin-bottom: 5px;
    }

    /* 선택된 카테고리 강조 */
    .category-item.active {
        font-weight: bold;
        border-bottom: 2px solid black;
    }

    .card {
        width: 100%;
        height: auto; /* 가변 크기 */
        font-size: 14px;
    }

    .card-img-top {
        width: 100%;
        height: 160px; /* 이미지 높이 조정 */
        object-fit: cover;
    }

    .carousel-item img {
        width: 100%;
        height: 160px;
        object-fit: cover;
    }

    /* 리뷰 스타일 */
    .review-box {
        background-color: #f8f9fa;
        padding: 8px;
        border-radius: 5px;
        font-size: 12px;
        margin-top: 5px;
    }
        /* ✅ 헤더 스타일 */
    .header { display: flex; align-items: center; justify-content: space-between; padding: 15px 30px; border-bottom: 1px solid #ddd; background: white; }
    .menu { display: flex; gap: 20px; font-weight: 500; }
    .menu a { text-decoration: none; color: black; transition: 0.2s; }
    .menu a:hover { color: #ff385c; }
    .user-menu { display: flex; align-items: center; gap: 15px; }
    .profile-img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }

    /* ✅ 스크롤 컨테이너 스타일 */
    .scroll-container {
        display: flex;
        align-items: center;
        position: relative;
        justify-content: space-between;
    }

    /* ✅ 필터 버튼 스타일 (오른쪽 끝으로 이동) */
    .filter-button {
        background: white;
        border: 1px solid #ddd;
        border-radius: 20px;
        padding: 8px 15px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
        cursor: pointer;
        box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
        position: absolute;
        right: -10px; /* 🔥 오른쪽 끝으로 이동 */
        top: 50%;
        transform: translateY(-50%);
        z-index: 12; /* 필터 버튼이 가장 위에 있도록 설정 */
    }

    /* ✅ 스크롤 버튼 위치 조정 (겹침 방지) */
    .scroll-button {
        background: white;
        border: 1px solid #ddd;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
        position: absolute;
        z-index: 11;
    }

    /* 왼쪽 버튼 위치 */
    .scroll-button.left {
        left: -50px;
    }

    /* 오른쪽 버튼 위치 (필터 버튼과 겹치지 않도록 조정) */
    .scroll-button.right {
        right: 70px;  /* 🔥 필터 버튼보다 왼쪽으로 이동 */
    }

    /* ✅ 카테고리 바 너비 조정 */
    .category-container {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: hidden;
        scrollbar-width: none;
        -webkit-overflow-scrolling: touch;
        max-width: calc(100% - 120px); /* 🔥 필터 버튼과 스크롤 버튼 고려하여 자동 너비 조정 */
        gap: 15px;
    }

    .category-container::-webkit-scrollbar {
        display: none;
    }

    /* ✅ 카테고리 아이콘 크기 조정 */
    .category-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        font-size: 14px;
        cursor: pointer;
        min-width: 90px;
        text-align: center;
        flex-shrink: 0;
    }

    .category-item i {
        font-size: 20px;
        margin-bottom: 5px;
    }

  </style>
</head>
<body>
<!-- ✅ 헤더 -->
<!-- ✅ 헤더 -->
<div class="header">
  <a href="/">
    <img src="/uploads/logo-text.png" alt="로고" height="40"> <!-- 로고 -->
  </a>

  <!-- ✅ 우측 유저 정보 -->
  <div class="user-menu">

    <!-- ✅ 유저 정보가 있을 때 -->
    <div th:if="${user != null}" class="d-flex align-items-center gap-3">
      <button class="btn btn-light">🔔 알림</button>
      <img th:src="${user.profileImageUrl}" alt="프로필 이미지" class="profile-img">
      <span th:text="${user.name}">사용자 이름</span>

      <!-- ✅ 부트스트랩 드롭다운 메뉴 추가 -->
      <div class="dropdown">
        <button class="btn btn-warning dropdown-toggle" type="button" id="userMenuDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          메뉴
        </button>
        <ul class="dropdown-menu" aria-labelledby="userMenuDropdown">
          <li><a class="dropdown-item" href="/profile">내 프로필</a></li>
          <li><a class="dropdown-item" href="/settings">설정</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger" href="/logout">로그아웃</a></li>
        </ul>
      </div>
    </div>

    <!-- ✅ 유저 정보가 없을 때 로그인 버튼 표시 -->
    <div th:if="${user == null}">
      <a href="/login" class="btn btn-primary">로그인</a>
    </div>
  </div>
</div>

<!-- ✅ 검색창 -->
<div class="search-bar">
  <input type="text" class="search-input" placeholder="여행지 검색">
  <input type="text" class="search-input" placeholder="체크인 날짜 추가">
  <input type="text" class="search-input" placeholder="체크아웃 날짜 추가">
  <input type="text" class="search-input" placeholder="게스트 추가">
  <button class="search-button"><i class="fa fa-search"></i></button>
</div>

<!-- 카테고리 바 -->
<div class="container mt-3 position-relative" id="category-wrapper">
  <div class="scroll-container">
    <button class="scroll-button left" onclick="scrollCategory('left')">
      <i class="fa fa-chevron-left"></i>
    </button>

    <div class="category-container" id="category-buttons">
      <!-- 동적으로 카테고리 추가 -->
    </div>

    <button class="scroll-button right" onclick="scrollCategory('right')">
      <i class="fa fa-chevron-right"></i>
    </button>
  </div>

  <!-- ✅ 필터 버튼을 스크롤 버튼과 겹치지 않도록 조정 -->
  <button class="filter-button">
    <i class="fa fa-sliders"></i> 필터
  </button>
</div>

<!-- 숙소 목록 -->
<div class="container mt-4">
  <div class="row" id="rooms-container">
    <!-- JavaScript가 숙소 목록을 동적으로 추가 -->
  </div>
</div>

<!-- Bootstrap 및 JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
      fetch("/main") // 서버에서 JSON 데이터 가져오기
          .then(response => response.json())
          .then(data => {
              displayCategories(data.categories);
              displayRooms(data.rooms);
          })
          .catch(error => console.error("데이터 불러오기 오류:", error));
  });

  // 카테고리 아이콘 매핑
  const categoryIcons = {
      "인기 숙소": "fa-star",
      "제주 한달살기": "fa-umbrella-beach",
      "통나무집": "fa-tree",
      "캠핑": "fa-campground",
      "카라반": "fa-caravan",
      "도시": "fa-city",
      "시골": "fa-house-chimney",
      "숲": "fa-leaf",
      "골프": "fa-golf-ball-tee",
      "한옥": "fa-landmark",
      "섬": "fa-water",
      "키즈": "fa-child",
      "전통": "fa-balance-scale",
      "호수": "fa-water",
      "고급": "fa-gem",
      "산": "fa-mountain",
      "바다": "fa-water",
      "독특한 테마": "fa-paint-brush",
      "수영장": "fa-swimmer",
      "스키장": "fa-skiing",
      "서핑": "fa-water",
      "반려동물": "fa-paw"
  };

  // 카테고리 버튼 생성
  function displayCategories(categories) {

      const categoryContainer = document.getElementById("category-buttons");

      categories.forEach(category => {
          const categoryDiv = document.createElement("div");
          categoryDiv.className = "category-item";
          categoryDiv.innerHTML = `
              <i class="fa ${categoryIcons[category.name] || 'fa-home'}"></i>
              ${category.name}
          `;
          categoryDiv.onclick = () => filterRooms(category.name);
          categoryContainer.appendChild(categoryDiv);
      });
  }

  //스크롤적용
  function scrollCategory(direction) {
      const container = document.getElementById("category-buttons");
      const scrollAmount = 300; // 이동 거리(px)

      if (direction === "left") {
          container.scrollBy({ left: -scrollAmount, behavior: "smooth" });
      } else {
          container.scrollBy({ left: scrollAmount, behavior: "smooth" });
      }
  }

  // 숙소 목록 생성
  function displayRooms(rooms) {
      const roomsContainer = document.getElementById("rooms-container");
      roomsContainer.innerHTML = ""; // 기존 목록 초기화

      rooms.forEach(room => {
          const card = document.createElement("div");
          card.className = "col-md-3 mb-4"; /* 한 줄에 4개씩 배치 */
          card.innerHTML = `
            <a href="/room/${room.roomId}" class="room-link">
                <div class="card">
                    <div id="carousel-${room.roomId}" class="carousel slide">
                        <div class="carousel-inner">
                            ${room.images.map((image, index) => `
                                <div class="carousel-item ${index === 0 ? 'active' : ''}">
                                    <img src="${image.fileUrl}" class="d-block w-100" alt="숙소 이미지">
                                </div>
                            `).join("")}
                        </div>
                        <a class="carousel-control-prev" href="#carousel-${room.roomId}" role="button" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#carousel-${room.roomId}" role="button" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </a>
                    </div>

                    <div class="card-body">
                        <h6 class="card-title">${room.title}</h6>
                        <p class="card-text">${room.address}</p>
                        <p class="card-text"><strong>₩${room.price.toLocaleString()} / 박</strong></p>
                        <p class="card-text">⭐ ${room.reviewScore} (리뷰 ${room.reviewCount}개)</p>

                        ${room.recentReview ? `
                            <div class="review-box">
                                <p><strong>${room.recentReview.userName}</strong>:
                                    ${room.recentReview.content} (⭐ ${room.recentReview.score})
                                </p>
                            </div>
                        ` : ""}
                    </div>
                </div>
            </a>
          `;
          roomsContainer.appendChild(card);
      });
  }

  function filterRooms(category) {
      console.log(category + " 필터 적용됨 (필터 기능 추가 필요)");
  }
</script>

</body>
</html>
