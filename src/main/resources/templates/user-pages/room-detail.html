<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìœ ì € ì •ë³´</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* ì‚¬ìš©ì ì •ë³´ ì˜ì—­ */
    .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .profile-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
    }
    .user-name {
        font-size: 16px;
        font-weight: 600;
    }
    .menu-button {
        background: none;
        border: none;
        cursor: pointer;
    }
    .menu-button img {
        width: 30px;
        height: 30px;
    }
    .navbar {
        padding: 10px 20px;
    }
  </style>

  <style>
    .gallery-container {
        max-width: 900px;
        margin: 0 auto;
    }
    .main-image {
        width: 100%;
        height: 400px;
        object-fit: cover;
        border-radius: 8px;
    }
    .thumbnail-container img {
        width: 100%;
        height: 100px;
        object-fit: cover;
        border-radius: 8px;
        cursor: pointer;
        transition: opacity 0.3s;
    }
    .thumbnail-container img:hover {
        opacity: 0.7;
    }
  </style>


  <style>
    .map-container {
        width: 100%;
        height: 400px;
        border-radius: 8px;
    }
  </style>
</head>
<body>

<!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<nav class="navbar navbar-light bg-light d-flex justify-content-end">
  <div class="user-info">
    <!-- ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸ -->
    <th:block th:if="${user != null}">
      <!-- ë¡œê·¸ì¸í•œ ê²½ìš° -->
      <input type="hidden" th:value="${user.userId}">
      <span class="user-name" th:text="${user.name}">ì‚¬ìš©ì ì´ë¦„</span>
      <button class="menu-button">ë©”ë‰´</button>
    </th:block>

    <th:block th:if="${user == null}">
      <!-- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° -->
      <a href="/login" class="btn btn-primary">ë¡œê·¸ì¸</a>
    </th:block>
  </div>
</nav>




<div class="container mt-4 gallery-container">
  <!-- ì²« ë²ˆì§¸ ì´ë¯¸ì§€ (ë©”ì¸ ì´ë¯¸ì§€ ëŒ€ì‹ ) -->
  <div>
    <img id="mainImage" th:src="${room.imageUrls[0]}" alt="ìˆ™ì†Œ ì´ë¯¸ì§€" class="main-image">
  </div>

  <!-- ì¸ë„¤ì¼ ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸ (ìµœëŒ€ 5ê°œë§Œ) -->
  <div class="row mt-2 thumbnail-container">
    <div class="col-3" th:each="image, iterStat : ${room.imageUrls}" th:if="${iterStat.index < 5}">
      <img th:src="${image}" alt="ìˆ™ì†Œ ì´ë¯¸ì§€" class="thumbnail" onclick="changeImage(this)">
    </div>
  </div>
</div>


<div class="container mt-4">
  <div class="row">
    <!-- ì™¼ìª½: ìˆ™ì†Œ ì •ë³´ -->
    <div class="col-md-7">
      <h3 th:text="${room.title}">ìˆ™ì†Œ ì œëª©</h3>
      <p class="text-muted">
        ìµœëŒ€ ì¸ì› <span th:text="${room.maxGuests}">4</span>ëª… Â·
        ì¹¨ì‹¤ <span th:text="${room.bedrooms}">1</span>ê°œ Â·
        ì¹¨ëŒ€ <span th:text="${room.beds}">2</span>ê°œ Â·
        ìš•ì‹¤ <span th:text="${room.bathrooms}">1</span>ê°œ
      </p>
      <p>
        â­ <span th:text="${room.rating}">4.55</span> Â·
        <a href="#">í›„ê¸° <span th:text="${room.reviewCount}">58</span>ê°œ</a>
      </p>

      <!-- í¸ì˜ì‹œì„¤ ë¦¬ìŠ¤íŠ¸ -->
      <div class="row">
        <div class="col-6" th:each="facility : ${room.options}">
          <span>âœ”ï¸</span> <span th:text="${facility}">ì„¸íƒê¸°</span>
        </div>
      </div>

      <hr>

      <!-- í˜¸ìŠ¤íŠ¸ ì •ë³´ -->
      <div class="d-flex align-items-center">
        <!-- í˜¸ìŠ¤íŠ¸ ì´ë¯¸ì§€ (nullì´ ì•„ë‹ ë•Œë§Œ ë Œë”ë§) -->
        <img th:if="${host.imageUrl != null}" th:src="${host.imageUrl}" class="rounded-circle me-3" width="50" height="50" alt="í˜¸ìŠ¤íŠ¸ ì´ë¯¸ì§€">

        <div>
          <h5 class="mb-0" th:text="${host.name}">í˜¸ìŠ¤íŠ¸ ì´ë¦„</h5>
          <p class="text-muted">
            í˜¸ìŠ¤íŒ… ê²½ë ¥
            <span th:if="${host.yearsOfExperience > 0}" th:text="${host.yearsOfExperience} + 'ë…„'">3ë…„</span>
            <span th:if="${host.yearsOfExperience == 0}">1ë…„ ë¯¸ë§Œ</span>
          </p>

        </div>
      </div>


      <div class="mt-3 p-3 bg-light rounded">
        <p th:text="${room.content}">
          ìˆ™ì†Œ ì„¤ëª…ì´ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤.
        </p>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ì˜ˆì•½ ë°•ìŠ¤ -->
    <div class="col-md-5">
      <div class="card p-3 shadow-sm">
        <div class="d-flex justify-content-between">
          <span class="fw-bold fs-5 text-danger" th:text="'â‚©' + ${room.pricePerNight}">â‚©60,000</span> /ë°•
        </div>

        <!-- ì˜ˆì•½ í¼ -->
        <form class="mt-3">
          <label class="form-label">ì²´í¬ì¸</label>
          <input type="date" class="form-control" id="checkInDate">

          <label class="form-label mt-2">ì²´í¬ì•„ì›ƒ</label>
          <input type="date" class="form-control" id="checkOutDate">

          <label class="form-label mt-2">ì¸ì›</label>
          <select class="form-select">
            <option th:each="num : ${#numbers.sequence(1, room.maxGuests)}"
                    th:value="${num}" th:text="|ê²ŒìŠ¤íŠ¸ ${num}ëª…|"></option>
          </select>

          <button type="submit" class="btn btn-danger w-100 mt-3">ì˜ˆì•½í•˜ê¸°</button>
        </form>

        <p class="text-muted mt-2">ì˜ˆì•½ í™•ì • ì „ì—ëŠ” ìš”ê¸ˆì´ ì²­êµ¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>

        <hr>

        <!-- ìš”ê¸ˆ ìƒì„¸ (ìˆ™ë°• ì¼ìˆ˜ ë™ì  ê³„ì‚°) -->
        <div class="d-flex justify-content-between">
          <span id="priceDetails" th:text="'â‚©' + ${room.pricePerNight} + 'X 1ë°•'">â‚©60,000 x 1ë°•</span>
          <span id="totalPrice" th:text="'â‚©' + ${room.pricePerNight}">â‚©60,000</span>
        </div>

        <hr>

        <div class="d-flex justify-content-between fw-bold">
          <span>ì´ì•¡</span>
          <span id="finalTotal">â‚©60,000</span>
        </div>
      </div>


      <!-- ìš”ê¸ˆ ì•ˆë‚´ -->
<!--      <div class="alert alert-light mt-3">-->
<!--        <span>ğŸ’°</span> ìš”ê¸ˆ ì¸í•˜<br>-->
<!--        ì§€ë‚œ 60ì¼ê°„ í‰ê·  ìš”ê¸ˆë³´ë‹¤ <span class="fw-bold text-danger" th:text="'â‚©' + ${room.discountAmount}">â‚©38,338</span> ì €ë ´í•©ë‹ˆë‹¤.-->
<!--      </div>-->

      <!-- ì‹ ê³  ë²„íŠ¼ urlì—°ê²°-->
      <button class="btn btn-outline-secondary w-100 mt-2">ğŸ  ìˆ™ì†Œ ì‹ ê³ í•˜ê¸°</button>
    </div>
  </div>

</div>


<div class="container mt-5">
  <h4>ìœ„ì¹˜</h4>
  <p th:text="${room.address}">ì„œìš¸, í•œêµ­</p>

  <!-- ì§€ë„ í‘œì‹œ ì˜ì—­ -->
  <div id="map" class="map-container"></div>
</div>
<div class="container mt-5" th:if="${reviews != null and not #lists.isEmpty(reviews)}">
  <h4>â­ <span th:text="${room.rating}">4.55</span> Â· í›„ê¸° <span th:text="${room.reviewCount}">58</span>ê°œ</h4>

  <hr>

  <div class="row">
    <div class="col-md-6" th:each="review : ${reviews}">
      <div class="d-flex align-items-center mb-2">
        <img th:if="${review.user != null}" th:src="${review.user.profileImageUrl}" class="rounded-circle me-2" width="50" height="50" alt="ìœ ì € ì´ë¯¸ì§€">
        <div>
          <strong th:text="${review.user != null ? review.user.name : 'ìµëª… ì‚¬ìš©ì'}">ì‚¬ìš©ì ì´ë¦„</strong>
        </div>
      </div>

      <p>â­ <span th:text="${review.rating}">5.0</span></p>
      <p th:text="${review.content}">ë¦¬ë·° ë‚´ìš©ì´ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
      <p class="text-muted small"
         th:if="${review.date != null}"
         th:text="${#temporals.format(review.date, 'yyyyë…„ Mì›”')}">
      </p>
      <p class="text-muted small" th:if="${review.date == null}">ë‚ ì§œ ì •ë³´ ì—†ìŒ</p>

      <hr>
    </div>
  </div>

  <button class="btn btn-outline-secondary w-100 mt-3">í›„ê¸° <span th:text="${room.reviewCount}">58</span>ê°œ ëª¨ë‘ ë³´ê¸°</button>
</div>


<div class="container mt-5">
  <h4>ìˆ™ì†Œ í¸ì˜ì‹œì„¤</h4>

  <div class="row">
    <!-- í¸ì˜ì‹œì„¤ ë¦¬ìŠ¤íŠ¸ -->
    <div class="col-md-4 mb-2" th:each="amenity : ${room.options}">
      <span>âœ”ï¸</span> <span th:text="${amenity}">í¸ì˜ì‹œì„¤ í•­ëª©</span>
    </div>
  </div>

  <button class="btn btn-outline-secondary mt-3">í¸ì˜ì‹œì„¤ ëª¨ë‘ ë³´ê¸°</button>
</div>

<div class="container mt-5">
  <h4>í˜¸ìŠ¤íŠ¸ ì†Œê°œ</h4>

  <div class="row">
    <!-- í˜¸ìŠ¤íŠ¸ í”„ë¡œí•„ ì¹´ë“œ -->
    <div class="col-md-6">
      <div class="card p-4 shadow-sm">
        <div class="d-flex flex-column align-items-center">
          <img th:src="${host.imageUrl}" class="rounded-circle mb-3" width="100" height="100" alt="í˜¸ìŠ¤íŠ¸ ì´ë¯¸ì§€">
          <h5 class="fw-bold mb-1" th:text="${host.name}">í˜¸ìŠ¤íŠ¸ ì´ë¦„</h5>
          <p class="text-muted">í˜¸ìŠ¤íŠ¸</p>
          <div class="text-center">
            <p>í›„ê¸° <strong th:text="${host.reviewCount}">1300</strong>ê°œ</p>
            <p>í‰ì  <strong th:text="${host.rating}">4.68</strong>â­</p>
            <p class="text-muted">
              í˜¸ìŠ¤íŒ… ê²½ë ¥
              <span th:if="${host.yearsOfExperience > 0}" th:text="${host.yearsOfExperience} + 'ë…„'">3ë…„</span>
              <span th:if="${host.yearsOfExperience == 0}">1ë…„ ë¯¸ë§Œ</span>
            </p>

          </div>
        </div>
      </div>
    </div>

      <h5>í˜¸ìŠ¤íŠ¸ ìƒì„¸ ì •ë³´</h5>
      <p>ì·¨ë¯¸: <strong th:text="${host.hobby}">100%</strong></p>
      <p>ì†Œê°œ: <strong th:text="${host.introduction}">100%</strong></p>
      <p>1ì‹œê°„ ì´ë‚´ ì‘ë‹µ</p>

      <button class="btn btn-dark w-100">í˜¸ìŠ¤íŠ¸ì—ê²Œ ë©”ì‹œì§€ ë³´ë‚´ê¸°</button>

      <p class="text-muted mt-3">
        ì•ˆì „í•œ ê²°ì œë¥¼ ìœ„í•´ í•­ìƒ ì—ì–´ë¹„ì•¤ë¹„ë¥¼ í†µí•´ ì†¡ê¸ˆí•˜ê³  í˜¸ìŠ¤íŠ¸ì™€ ì†Œí†µí•˜ì„¸ìš”.
      </p>
    </div>
  </div>
</div>


<!-- Bootstrap JS (Popper.js í¬í•¨) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  function changeImage(element) {
      document.getElementById("mainImage").src = element.src;
  }
</script>
<!-- Google Maps API ìŠ¤í¬ë¦½íŠ¸ -->
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap">
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const checkInInput = document.getElementById("checkInDate");
    const checkOutInput = document.getElementById("checkOutDate");
    const priceDetails = document.getElementById("priceDetails");
    const totalPrice = document.getElementById("totalPrice");
    const finalTotal = document.getElementById("finalTotal");

    const pricePerNight = parseInt([[${room.pricePerNight}]]); // Thymeleafì—ì„œ ê°€ê²© ê°€ì ¸ì˜¤ê¸°

    function updatePrice() {
      const checkInDate = new Date(checkInInput.value);
      const checkOutDate = new Date(checkOutInput.value);

      if (isNaN(checkInDate) || isNaN(checkOutDate) || checkOutDate <= checkInDate) {
        priceDetails.innerText = `â‚©${pricePerNight} x 1ë°•`;
        totalPrice.innerText = `â‚©${pricePerNight}`;
        finalTotal.innerText = `â‚©${pricePerNight}`;
        return;
      }

      // ìˆ™ë°• ì¼ìˆ˜ ê³„ì‚°
      const nights = Math.round((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));

      // ê°€ê²© ê³„ì‚°
      const total = pricePerNight * nights;

      // í™”ë©´ ì—…ë°ì´íŠ¸
      priceDetails.innerText = `â‚©${pricePerNight} x ${nights}ë°•`;
      totalPrice.innerText = `â‚©${total}`;
      finalTotal.innerText = `â‚©${total}`;
    }

    checkInInput.addEventListener("change", updatePrice);
    checkOutInput.addEventListener("change", updatePrice);
  });
</script>

<script>


  function initMap() {
      var roomLocation = {
          lat: parseFloat([[${room.latitude}]]),
          lng: parseFloat([[${room.longitude}]])
      };

      var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 14,
          center: roomLocation
      });

      var marker = new google.maps.Marker({
          position: roomLocation,
          map: map,
          title: 'ìˆ™ì†Œ ìœ„ì¹˜'
      });
  }
</script>
</body>
</html>
