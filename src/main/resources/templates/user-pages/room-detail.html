<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>유저 정보</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* 사용자 정보 영역 */
    .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .profile-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
    }
    .user-name {
        font-size: 16px;
        font-weight: 600;
    }
    .menu-button {
        background: none;
        border: none;
        cursor: pointer;
    }
    .menu-button img {
        width: 30px;
        height: 30px;
    }
    .navbar {
        padding: 10px 20px;
    }
  </style>

  <style>
    .gallery-container {
        max-width: 900px;
        margin: 0 auto;
    }
    .main-image {
        width: 100%;
        height: 400px;
        object-fit: cover;
        border-radius: 8px;
    }
    .thumbnail-container img {
        width: 100%;
        height: 100px;
        object-fit: cover;
        border-radius: 8px;
        cursor: pointer;
        transition: opacity 0.3s;
    }
    .thumbnail-container img:hover {
        opacity: 0.7;
    }
  </style>


  <style>
    .map-container {
        width: 100%;
        height: 400px;
        border-radius: 8px;
    }
  </style>
</head>
<body>

<!-- 네비게이션 바 -->
<nav class="navbar navbar-light bg-light d-flex justify-content-end">
  <div class="user-info">
    <!-- 로그인 여부 확인 -->
    <th:block th:if="${user != null}">
      <!-- 로그인한 경우 -->
      <input type="hidden" th:value="${user.userId}">
      <span class="user-name" th:text="${user.name}">사용자 이름</span>
      <button class="menu-button">메뉴</button>
    </th:block>

    <th:block th:if="${user == null}">
      <!-- 로그인하지 않은 경우 -->
      <a href="/login" class="btn btn-primary">로그인</a>
    </th:block>
  </div>
</nav>




<div class="container mt-4 gallery-container">
  <!-- 첫 번째 이미지 (메인 이미지 대신) -->
  <div>
    <img id="mainImage" th:src="${room.imageUrls[0]}" alt="숙소 이미지" class="main-image">
  </div>

  <!-- 썸네일 이미지 리스트 (최대 5개만) -->
  <div class="row mt-2 thumbnail-container">
    <div class="col-3" th:each="image, iterStat : ${room.imageUrls}" th:if="${iterStat.index < 5}">
      <img th:src="${image}" alt="숙소 이미지" class="thumbnail" onclick="changeImage(this)">
    </div>
  </div>
</div>


<div class="container mt-4">
  <div class="row">
    <!-- 왼쪽: 숙소 정보 -->
    <div class="col-md-7">
      <h3 th:text="${room.title}">숙소 제목</h3>
      <p class="text-muted">
        최대 인원 <span th:text="${room.maxGuests}">4</span>명 ·
        침실 <span th:text="${room.bedrooms}">1</span>개 ·
        침대 <span th:text="${room.beds}">2</span>개 ·
        욕실 <span th:text="${room.bathrooms}">1</span>개
      </p>
      <p>
        ⭐ <span th:text="${room.rating}">4.55</span> ·
        <a href="#">후기 <span th:text="${room.reviewCount}">58</span>개</a>
      </p>

      <!-- 편의시설 리스트 -->
      <div class="row">
        <div class="col-6" th:each="facility : ${room.options}">
          <span>✔️</span> <span th:text="${facility}">세탁기</span>
        </div>
      </div>

      <hr>

      <!-- 호스트 정보 -->
      <div class="d-flex align-items-center">
        <!-- 호스트 이미지 (null이 아닐 때만 렌더링) -->
        <img th:if="${host.imageUrl != null}" th:src="${host.imageUrl}" class="rounded-circle me-3" width="50" height="50" alt="호스트 이미지">

        <div>
          <h5 class="mb-0" th:text="${host.name}">호스트 이름</h5>
          <p class="text-muted">
            호스팅 경력
            <span th:if="${host.yearsOfExperience > 0}" th:text="${host.yearsOfExperience} + '년'">3년</span>
            <span th:if="${host.yearsOfExperience == 0}">1년 미만</span>
          </p>

        </div>
      </div>


      <div class="mt-3 p-3 bg-light rounded">
        <p th:text="${room.content}">
          숙소 설명이 여기에 들어갑니다.
        </p>
      </div>
    </div>

    <!-- 오른쪽: 예약 박스 -->
    <div class="col-md-5">
      <div class="card p-3 shadow-sm">
        <div class="d-flex justify-content-between">
          <span class="fw-bold fs-5 text-danger" th:text="'₩' + ${room.pricePerNight}">₩60,000</span> /박
        </div>

        <!-- 예약 폼 -->
        <form class="mt-3">
          <label class="form-label">체크인</label>
          <input type="date" class="form-control" id="checkInDate">

          <label class="form-label mt-2">체크아웃</label>
          <input type="date" class="form-control" id="checkOutDate">

          <label class="form-label mt-2">인원</label>
          <select class="form-select">
            <option th:each="num : ${#numbers.sequence(1, room.maxGuests)}"
                    th:value="${num}" th:text="|게스트 ${num}명|"></option>
          </select>

          <button type="submit" class="btn btn-danger w-100 mt-3">예약하기</button>
        </form>

        <p class="text-muted mt-2">예약 확정 전에는 요금이 청구되지 않습니다.</p>

        <hr>

        <!-- 요금 상세 (숙박 일수 동적 계산) -->
        <div class="d-flex justify-content-between">
          <span id="priceDetails" th:text="'₩' + ${room.pricePerNight} + 'X 1박'">₩60,000 x 1박</span>
          <span id="totalPrice" th:text="'₩' + ${room.pricePerNight}">₩60,000</span>
        </div>

        <hr>

        <div class="d-flex justify-content-between fw-bold">
          <span>총액</span>
          <span id="finalTotal">₩60,000</span>
        </div>
      </div>


      <!-- 요금 안내 -->
<!--      <div class="alert alert-light mt-3">-->
<!--        <span>💰</span> 요금 인하<br>-->
<!--        지난 60일간 평균 요금보다 <span class="fw-bold text-danger" th:text="'₩' + ${room.discountAmount}">₩38,338</span> 저렴합니다.-->
<!--      </div>-->

      <!-- 신고 버튼 url연결-->
      <button class="btn btn-outline-secondary w-100 mt-2">🏠 숙소 신고하기</button>
    </div>
  </div>

</div>


<div class="container mt-5">
  <h4>위치</h4>
  <p th:text="${room.address}">서울, 한국</p>

  <!-- 지도 표시 영역 -->
  <div id="map" class="map-container"></div>
</div>
<div class="container mt-5" th:if="${reviews != null and not #lists.isEmpty(reviews)}">
  <h4>⭐ <span th:text="${room.rating}">4.55</span> · 후기 <span th:text="${room.reviewCount}">58</span>개</h4>

  <hr>

  <div class="row">
    <div class="col-md-6" th:each="review : ${reviews}">
      <div class="d-flex align-items-center mb-2">
        <img th:if="${review.user != null}" th:src="${review.user.profileImageUrl}" class="rounded-circle me-2" width="50" height="50" alt="유저 이미지">
        <div>
          <strong th:text="${review.user != null ? review.user.name : '익명 사용자'}">사용자 이름</strong>
        </div>
      </div>

      <p>⭐ <span th:text="${review.rating}">5.0</span></p>
      <p th:text="${review.content}">리뷰 내용이 여기에 들어갑니다.</p>
      <p class="text-muted small"
         th:if="${review.date != null}"
         th:text="${#temporals.format(review.date, 'yyyy년 M월')}">
      </p>
      <p class="text-muted small" th:if="${review.date == null}">날짜 정보 없음</p>

      <hr>
    </div>
  </div>

  <button class="btn btn-outline-secondary w-100 mt-3">후기 <span th:text="${room.reviewCount}">58</span>개 모두 보기</button>
</div>


<div class="container mt-5">
  <h4>숙소 편의시설</h4>

  <div class="row">
    <!-- 편의시설 리스트 -->
    <div class="col-md-4 mb-2" th:each="amenity : ${room.options}">
      <span>✔️</span> <span th:text="${amenity}">편의시설 항목</span>
    </div>
  </div>

  <button class="btn btn-outline-secondary mt-3">편의시설 모두 보기</button>
</div>

<div class="container mt-5">
  <h4>호스트 소개</h4>

  <div class="row">
    <!-- 호스트 프로필 카드 -->
    <div class="col-md-6">
      <div class="card p-4 shadow-sm">
        <div class="d-flex flex-column align-items-center">
          <img th:src="${host.imageUrl}" class="rounded-circle mb-3" width="100" height="100" alt="호스트 이미지">
          <h5 class="fw-bold mb-1" th:text="${host.name}">호스트 이름</h5>
          <p class="text-muted">호스트</p>
          <div class="text-center">
            <p>후기 <strong th:text="${host.reviewCount}">1300</strong>개</p>
            <p>평점 <strong th:text="${host.rating}">4.68</strong>⭐</p>
            <p class="text-muted">
              호스팅 경력
              <span th:if="${host.yearsOfExperience > 0}" th:text="${host.yearsOfExperience} + '년'">3년</span>
              <span th:if="${host.yearsOfExperience == 0}">1년 미만</span>
            </p>

          </div>
        </div>
      </div>
    </div>

      <h5>호스트 상세 정보</h5>
      <p>취미: <strong th:text="${host.hobby}">100%</strong></p>
      <p>소개: <strong th:text="${host.introduction}">100%</strong></p>
      <p>1시간 이내 응답</p>

      <button class="btn btn-dark w-100">호스트에게 메시지 보내기</button>

      <p class="text-muted mt-3">
        안전한 결제를 위해 항상 에어비앤비를 통해 송금하고 호스트와 소통하세요.
      </p>
    </div>
  </div>
</div>


<!-- Bootstrap JS (Popper.js 포함) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  function changeImage(element) {
      document.getElementById("mainImage").src = element.src;
  }
</script>
<!-- Google Maps API 스크립트 -->
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap">
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const checkInInput = document.getElementById("checkInDate");
    const checkOutInput = document.getElementById("checkOutDate");
    const priceDetails = document.getElementById("priceDetails");
    const totalPrice = document.getElementById("totalPrice");
    const finalTotal = document.getElementById("finalTotal");

    const pricePerNight = parseInt([[${room.pricePerNight}]]); // Thymeleaf에서 가격 가져오기

    function updatePrice() {
      const checkInDate = new Date(checkInInput.value);
      const checkOutDate = new Date(checkOutInput.value);

      if (isNaN(checkInDate) || isNaN(checkOutDate) || checkOutDate <= checkInDate) {
        priceDetails.innerText = `₩${pricePerNight} x 1박`;
        totalPrice.innerText = `₩${pricePerNight}`;
        finalTotal.innerText = `₩${pricePerNight}`;
        return;
      }

      // 숙박 일수 계산
      const nights = Math.round((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));

      // 가격 계산
      const total = pricePerNight * nights;

      // 화면 업데이트
      priceDetails.innerText = `₩${pricePerNight} x ${nights}박`;
      totalPrice.innerText = `₩${total}`;
      finalTotal.innerText = `₩${total}`;
    }

    checkInInput.addEventListener("change", updatePrice);
    checkOutInput.addEventListener("change", updatePrice);
  });
</script>

<script>


  function initMap() {
      var roomLocation = {
          lat: parseFloat([[${room.latitude}]]),
          lng: parseFloat([[${room.longitude}]])
      };

      var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 14,
          center: roomLocation
      });

      var marker = new google.maps.Marker({
          position: roomLocation,
          map: map,
          title: '숙소 위치'
      });
  }
</script>
</body>
</html>
